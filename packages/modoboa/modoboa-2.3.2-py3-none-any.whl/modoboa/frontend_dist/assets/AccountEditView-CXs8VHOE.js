import{b as D,as as O,ad as J,M as z,N as H,G as f,i as C,d as K,k as W,f as n,o as s,c as m,Q as p,a,w as e,R as c,t as o,e as v,J as M,S as y,_ as X}from"./index-BAZgbal1.js";import{_ as Y,a as Z,A as ee,b as ae}from"./AccountAliasForm-w9j-hq2x.js";import{_ as le}from"./ResourcesForm-C0ekEt5O.js";import{L as te}from"./LoadingData-BC4LJs1L.js";import{p as oe}from"./parameters-DfOTof2l.js";import{w as x,i as E,h as L}from"./index-2vnC8Vie.js";import{V,c as g,a as b,b as se}from"./VExpansionPanels-Y3_rJpHb.js";import{a as _,V as d}from"./VRow-B9t19ukL.js";import{V as ue,a as re}from"./VToolbar-7dK0ghH-.js";import"./ChoiceField-D9DGMcqD.js";import"./VAlert-hKmdjX4d.js";import"./tag-cARXM09U.js";import"./dimensions-BvonjXC6.js";import"./VForm-CMLbYr8a.js";import"./VTextField-B1aixe0Y.js";import"./forwardRefs-CjMRaIA6.js";import"./ssrBoot-CWMlusa3.js";import"./VAvatar-DuybK5Si.js";import"./AccountPasswordSubForm-D87veHTE.js";import"./VSwitch-gbuBfPzI.js";import"./VChip-CTOpyymj.js";import"./EmailField-tY9cX0RH.js";import"./VContainer-CpoaXVwO.js";/* empty css              */const ne={key:1},de={key:0},ie={key:0},me={class:"mr-2"},ce={class:"mr-2"},fe={key:0},_e={class:"mr-2"},ve={class:"mr-2"},pe={class:"mr-2"},ye={key:0},ke={class:"mr-2"},xe={key:0},Ve={class:"mr-2"},ge={class:"mr-2"},be={class:"mt-4 d-flex justify-end"},Fe={__name:"AccountEditForm",setup(Q){const{$gettext:r}=D(),N=O(),T=J(),S=z(),j=H(),l=f({pk:S.params.id}),F=C(()=>l.value.username&&l.value.username.indexOf("@")!==-1),R=C(()=>{const t=$.value.params&&$.value.params.enable_admin_limits&&l.value.role!=="SimpleUsers"&&l.value.role!=="SuperAdmins";return t===void 0?!1:t}),$=f({}),h=f(0),k=f(!1),w=f(!1),U=f(),I=f(),B=f(),P=f(),A=f(),q=C(()=>{const t={roleForm:U,generalForm:I};return F.value&&(t.aliasForm=P,t.mailboxForm=B),R.value&&(t.resourcesForm=A),t});async function G(){w.value=!1,h.value=[];for(const[t,i]of Object.entries(q.value))if(i.value!=null){const{valid:u}=await i.value.vFormRef.validate();u||(w.value=!0,h.value.push(t))}if(!w.value){k.value=!0;try{const t={...l.value};F.value?t.mailbox.full_address=t.username:delete t.mailbox.full_address,t.password||(delete t.password,delete t.password_confirmation),R.value&&A.value!==null&&(t.resources=A.value.getPayload()),t.aliases===null&&delete t.aliases,T.updateIdentity("account",t).then(()=>{j.push({name:"AccountDetail",params:{id:S.params.id}})})}finally{k.value=!1}}}return K(()=>{N.getAccount(S.params.id).then(t=>l.value={...t.data}),oe.getApplication("limits").then(t=>{$.value=t.data})}),W(l,()=>{delete l.value.domains,l.value.mailbox===null&&delete l.value.mailbox},{deep:!0}),(t,i)=>!n(N).accountsLoaded||k.value?(s(),m(te,{key:0})):(s(),p("div",ne,[a(se,{modelValue:h.value,"onUpdate:modelValue":i[5]||(i[5]=u=>h.value=u),multiple:w.value},{default:e(()=>[a(V,{eager:"",value:"roleForm"},{default:e(()=>[a(g,null,{default:e(({expanded:u})=>[a(_,{"no-gutters":""},{default:e(()=>[a(d,{cols:"4"},{default:e(()=>[c(o(n(r)("Role")),1)]),_:1}),a(d,{cols:"8",class:"text-medium-emphasis"},{default:e(()=>[a(x,{"leave-absolute":""},{default:e(()=>[u?(s(),p("span",de)):(s(),m(_,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[a(d,{cols:"6"},{default:e(()=>[c(o(U.value.roleLabel),1)]),_:1})]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),a(b,null,{default:e(()=>[a(Y,{ref_key:"roleForm",ref:U,modelValue:l.value,"onUpdate:modelValue":i[0]||(i[0]=u=>l.value=u)},null,8,["modelValue"])]),_:1})]),_:1}),a(V,{eager:"",value:"generalForm"},{default:e(()=>[a(g,null,{default:e(({expanded:u})=>[a(_,{"no-gutters":""},{default:e(()=>[a(d,{cols:"4"},{default:e(()=>[c(o(n(r)("Identification")),1)]),_:1}),a(d,{cols:"8",class:"text-secondary"},{default:e(()=>[a(x,{"leave-absolute":""},{default:e(()=>[u?(s(),p("span",ie)):(s(),m(_,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[a(d,{cols:"6"},{default:e(()=>[v("div",me,o(n(r)("Username:"))+" "+o(l.value.username),1)]),_:1}),a(d,{cols:"6"},{default:e(()=>[v("div",ce,[c(o(n(r)("Enabled"))+" ",1),l.value.is_active?(s(),m(E,{key:0,color:"success"},{default:e(()=>[c("mdi-check-circle-outline")]),_:1})):(s(),m(E,{key:1},{default:e(()=>[c("mdi-close-circle-outline")]),_:1}))])]),_:1})]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),a(b,null,{default:e(()=>[a(Z,{ref_key:"generalForm",ref:I,modelValue:l.value,"onUpdate:modelValue":i[1]||(i[1]=u=>l.value=u),editing:""},null,8,["modelValue"])]),_:1})]),_:1}),F.value?(s(),m(V,{key:0,eager:"",value:"mailboxForm"},{default:e(()=>[a(g,null,{default:e(({expanded:u})=>[a(_,{"no-gutters":""},{default:e(()=>[a(d,{cols:"4"},{default:e(()=>[c(o(n(r)("Mailbox")),1)]),_:1}),a(d,{cols:"8",class:"text-secondary"},{default:e(()=>[a(x,{"leave-absolute":""},{default:e(()=>[u?(s(),p("span",fe)):(s(),m(_,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[l.value.mailbox?(s(),p(M,{key:0},[l.value.mailbox.use_domain_quota?(s(),m(d,{key:0,cols:"6"},{default:e(()=>[v("div",_e,o(n(r)("Quota: "))+" "+o(n(r)("domain's default value")),1)]),_:1})):(s(),m(d,{key:1,cols:"6"},{default:e(()=>[v("div",ve,o(n(r)("Quota: "))+" "+o(l.value.mailbox.quota),1)]),_:1})),a(d,{cols:"6"},{default:e(()=>[v("div",pe,[c(o(n(r)("Send only"))+" ",1),l.value.mailbox.is_send_only?(s(),m(E,{key:0,color:"success"},{default:e(()=>[c("mdi-check-circle-outline")]),_:1})):(s(),m(E,{key:1},{default:e(()=>[c("mdi-close-circle-outline")]),_:1}))])]),_:1})],64)):y("",!0)]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),a(b,null,{default:e(()=>[a(ee,{ref_key:"mailboxForm",ref:B,modelValue:l.value,"onUpdate:modelValue":i[2]||(i[2]=u=>l.value=u)},null,8,["modelValue"])]),_:1})]),_:1})):y("",!0),F.value?(s(),m(V,{key:1,eager:"",value:"aliasForm"},{default:e(()=>[a(g,null,{default:e(({expanded:u})=>[a(_,{"no-gutters":""},{default:e(()=>[a(d,{cols:"4"},{default:e(()=>[c(o(n(r)("Alias")),1)]),_:1}),a(d,{cols:"8",class:"text-secondary"},{default:e(()=>[a(x,{"leave-absolute":""},{default:e(()=>[u?(s(),p("span",ye)):(s(),m(_,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[l.value.aliases?(s(),m(d,{key:0,cols:"6"},{default:e(()=>[v("div",ke,o(n(r)("Aliases:"))+" "+o(n(r)("Number of associated alias:"))+" "+o(l.value.aliases.length),1)]),_:1})):y("",!0)]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),a(b,null,{default:e(()=>[a(ae,{ref_key:"aliasForm",ref:P,modelValue:l.value,"onUpdate:modelValue":i[3]||(i[3]=u=>l.value=u)},null,8,["modelValue"])]),_:1})]),_:1})):y("",!0),R.value?(s(),m(V,{key:2,eager:"",value:"resourcesForm"},{default:e(()=>[a(g,null,{default:e(({expanded:u})=>[a(_,{"no-gutters":""},{default:e(()=>[a(d,{cols:"4"},{default:e(()=>[c(o(n(r)("Resources")),1)]),_:1}),a(d,{cols:"8",class:"text-secondary"},{default:e(()=>[a(x,{"leave-absolute":""},{default:e(()=>[u?(s(),p("span",xe)):(s(),m(_,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[l.value.resources!=null&&l.value.resources.length==2?(s(),p(M,{key:0},[a(d,{cols:"6"},{default:e(()=>[v("div",Ve,o(n(r)("Mailbox:"))+" "+o(n(r)("Number of allowed mailboxes:"))+" "+o(l.value.resources[0].max_value),1)]),_:1}),a(d,{cols:"6"},{default:e(()=>[v("div",ge,o(n(r)("Mailbox aliases:"))+" "+o(n(r)("Number of allowed mailbox aliases:"))+" "+o(l.value.resources[1].max_value),1)]),_:1})],64)):y("",!0)]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),a(b,null,{default:e(()=>[a(le,{ref_key:"resourcesForm",ref:A,modelValue:l.value.resources,"onUpdate:modelValue":i[4]||(i[4]=u=>l.value.resources=u)},null,8,["modelValue"])]),_:1})]),_:1})):y("",!0)]),_:1},8,["modelValue","multiple"]),v("div",be,[a(L,{loading:k.value,onClick:i[6]||(i[6]=u=>t.$router.go(-1))},{default:e(()=>[c(o(n(r)("Cancel")),1)]),_:1},8,["loading"]),a(L,{class:"ml-4",color:"primary darken-1",loading:k.value,onClick:G},{default:e(()=>[c(o(n(r)("Save")),1)]),_:1},8,["loading"])])]))}},he={__name:"AccountEditView",setup(Q){const{$gettext:r}=D();return(N,T)=>(s(),p(M,null,[a(ue,{flat:""},{default:e(()=>[a(re,null,{default:e(()=>[c(o(n(r)("Edit account")),1)]),_:1})]),_:1}),a(Fe)],64))}},Ke=X(he,[["__scopeId","data-v-4019c7f8"]]);export{Ke as default};
