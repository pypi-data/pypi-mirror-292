import{_ as $,b,a2 as U,i as p,G as o,d as z,au as B,av as F,K as T,o as v,Q as g,a as w,I as K,aw as N,w as y,J as k,U as P,c as R,P as W,R as G,t as O,S as j}from"./index-BAZgbal1.js";import{V as J}from"./VTextField-B1aixe0Y.js";import{a as Q,b as q,V as H}from"./forwardRefs-CjMRaIA6.js";const X={__name:"EmailField",props:{modelValue:{type:String,default:""},allowAdd:{type:Boolean,default:!1},role:{type:String,default:"SimpleUsers"},errorMsg:{type:Array,default:()=>[]}},emits:["domain-selected","update:model-value"],setup(D,{emit:A}){const{$gettext:C}=b(),h=U(),n=D,S=A,r=p({get(){return n.modelValue},set(e){u.value=[],e.indexOf("@")!==-1?n.role!=="SuperAdmins"?(i.value=e.split("@")[1],n.allowAdd?t.value=s.value.length>0:t.value=!0):u.value=[C("SuperAdmins cannot own a mailbox")]:t.value=!1,S("update:model-value",e)}}),s=p(()=>Object.values(h.domains).filter(e=>e.name.startsWith(i.value))),u=p({get(){return[..._.value,...n.errorMsg]},set(e){_.value=e}}),i=o(""),l=o(0),t=o(!1),V=o(500),x=o(),_=o([]);function E(e){if(n.role==="SuperAdmins")return;const a=e.keyCode;a===40||a===34?(t.value?I():(i.value="",t.value=!0),e.preventDefault()):a===38||a===33?(t.value?M():(i.value="",t.value=!0),e.preventDefault()):a===13||a===9?(s.value.length>0?c(s.value[l.value]):n.allowAdd&&c(),e.preventDefault()):a===27&&s.value.length>0&&(t.value=!1,e.preventDefault())}function I(){l.value>=s.value.length-1?l.value=0:l.value+=1}function M(){l.value<=0?l.value=s.value.length-1:l.value-=1}function c(e){e!==void 0&&(r.value=r.value.split("@")[0]+"@"+e.name),t.value=!1,S("domain-selected")}function m(){V.value=x.value.$el.clientWidth}return z(()=>{h.getDomains(),window.addEventListener("resize",m)}),B(()=>{window.removeEventListener("resize",m)}),F(()=>{T(()=>{m()})}),(e,a)=>(v(),g(k,null,[w(J,K({ref_key:"inputRef",ref:x,modelValue:r.value,"onUpdate:modelValue":a[0]||(a[0]=d=>r.value=d),variant:"outlined"},e.$attrs,{"error-messages":u.value,error:u.value.length>0,density:"compact",autocomplete:"new-password",onKeydown:E}),null,16,["modelValue","error-messages","error"]),t.value?(v(),g("div",{key:0,class:"menu",style:N(`width: ${V.value}px;`)},[w(H,{class:"list"},{default:y(()=>[(v(!0),g(k,null,P(s.value,(d,f)=>(v(),R(Q,{key:f,class:W(l.value===f?"bg-primary-lighten-1":""),onClick:L=>c(d),onMouseenter:L=>l.value=f},{default:y(()=>[w(q,null,{default:y(()=>[G(O(d.name),1)]),_:2},1024)]),_:2},1032,["class","onClick","onMouseenter"]))),128))]),_:1})],4)):j("",!0)],64))}},te=$(X,[["__scopeId","data-v-f4a8114a"]]);export{te as E};
