"use strict";(self.webpackChunkhintbot=self.webpackChunkhintbot||[]).push([[422],{422:(e,t,n)=>{n.r(t),n.d(t,{default:()=>f});var o=n(896),a=n(217),i=n(586),r=n(275),s=n(733),l=n(29),d=n.n(l);class c extends i.ReactWidget{constructor(e){super(),this._message="",this._message=e}getValue(){var e;return null===(e=this.node.querySelector("textarea"))||void 0===e?void 0:e.value}render(){return d().createElement("div",{className:"reflection"},d().createElement("p",null,this._message),d().createElement("textarea",{name:"reflection-input",className:"reflection-input",rows:10}),d().createElement("p",{style:{fontStyle:"italic"}},"Text entered here will be passed to the external language model service to improve hint relevance."))}}var u=n(281),p=n(663);async function h(e="",t={}){const n=p.ServerConnection.makeSettings(),o=u.URLExt.join(n.baseUrl,"hintbot",e);let a;try{a=await p.ServerConnection.makeRequest(o,t,n)}catch(e){throw new p.ServerConnection.NetworkError(e)}let i=await a.text();if(i.length>0)try{i=JSON.parse(i)}catch(e){console.log("Not a JSON response body.",a)}if(!a.ok)throw new p.ServerConnection.ResponseError(a,i.message||i);return i}const m=(e,t,n,o)=>{document.getElementById(`hint-history-bar-${e.id}`)&&document.getElementById(`hint-history-bar-${e.id}`).remove();const a=e.getMetadata("hintHistory"),i=document.createElement("div");if(i.classList.add("hint-history-bar"),i.id=`hint-history-bar-${e.id}`,a&&a.length>0){for(let t=0;t<a.length;t++){const r=document.createElement("div"),s=document.createElement("button");s.classList.add("accordion"),s.innerText=`Click to review previous hint ${t+1} (${a[t][0]})`;const l=document.createElement("div");l.classList.add("panel");const d=document.createElement("p");d.classList.add(),d.innerText=a[t][1],l.appendChild(d),r.appendChild(s),r.appendChild(l),i.appendChild(r),s.addEventListener("click",(function(){this.classList.toggle("active"),l.style.maxHeight?l.style.maxHeight=null:l.style.maxHeight=l.scrollHeight+"px",this.classList.contains("active")?o.exporters.forEach((i=>{o.publishEvent(n,{eventName:"HintHistoryReview",eventTime:Date.now(),eventInfo:{gradeId:e.getMetadata("nbgrader").grade_id,hintType:a[t][0],hintContent:a[t][1]}},i,!1)})):o.exporters.forEach((i=>{o.publishEvent(n,{eventName:"HintHistoryHide",eventTime:Date.now(),eventInfo:{gradeId:e.getMetadata("nbgrader").grade_id,hintType:a[t][0],hintContent:a[t][1]}},i,!1)}))}))}n.content.widgets[t].node.appendChild(i)}},g=async(e,t,n,o,a,r)=>{var l;const d=null===(l=o.getMetadata("nbgrader"))||void 0===l?void 0:l.grade_id,u=o.getMetadata("remaining_hints");if(document.getElementById("hint-banner"))(0,i.showDialog)({title:"Please review previous hint first.",buttons:[i.Dialog.createButton({label:"Dismiss",className:"jp-Dialog-button jp-mod-reject jp-mod-styled"})]}),n.exporters.forEach((t=>{n.publishEvent(e,{eventName:"HintAlreadyExists",eventTime:Date.now(),eventInfo:{gradeId:d}},t,!1)}));else if(u<1)(0,i.showDialog)({title:"No hint left for this question.",buttons:[i.Dialog.createButton({label:"Dismiss",className:"jp-Dialog-button jp-mod-reject jp-mod-styled"})]}),n.exporters.forEach((t=>{n.publishEvent(e,{eventName:"NotEnoughHint",eventTime:Date.now(),eventInfo:{gradeId:d}},t,!1)}));else{const t=(0,s.v4)(),l=0==(await h("id")).split("").map((e=>e.charCodeAt(0)-64)).reduce(((e,t)=>e+t),0)%2?"promptA":"promptB";console.log(`Condition ${l}`);const g=[{hintType:"planning",serverHintType:"plan",promptA:"Considering the program you wrote and the feedback you have received from the system so far, what do you think is a possible issue with the program plan and problem-solving steps?",promptB:"Considering the program you wrote and the feedback you have received from the system so far, what do you think is a possible issue with the program plan and problem-solving steps? Which steps in your program plan could be improved? How do you think the program plan can be updated to solve this question?"},{hintType:"debugging",serverHintType:"debug",promptA:"Considering the program you wrote and the feedback you have received from the system so far, what do you think is a possible bug in the program?",promptB:"Considering the program you wrote and the feedback you have received from the system so far, what do you think is a possible bug in the program? How does the bug affect the program? What do you think is a way to fix the bug?"},{hintType:"optimizing",serverHintType:"optimize",promptA:"Considering the program you wrote and the feedback you have received from the system so far, what do you think is a possible issue with the program in terms of performance and readability?",promptB:"Considering the program you wrote and the feedback you have received from the system so far, what do you think is a possible issue with the program in terms of performance and readability? Which parts of the program need to be optimized? How do you think the program can be improved?"}],b=await h("hint",{method:"POST",body:JSON.stringify({hint_type:g.find((e=>e.hintType===r)).serverHintType,problem_id:d,buggy_notebook_path:e.context.path})});console.log("create ticket",b);const v=null==b?void 0:b.request_id;o.setMetadata("remaining_hints",u-1),document.getElementById(d).innerText=`Request Hint (${u-1} left for this question)`,e.context.save();const y=await(p=g.find((e=>e.hintType===r))[l],(0,i.showDialog)({title:"Reflection",body:new c(p),buttons:[i.Dialog.cancelButton({label:"Cancel",className:"jp-Dialog-button jp-mod-reject jp-mod-styled"}),i.Dialog.createButton({label:"Submit",className:"jp-Dialog-button jp-mod-accept jp-mod-styled"})],hasClose:!1}));n.exporters.forEach((o=>{n.publishEvent(e,{eventName:"Reflection",eventTime:Date.now(),eventInfo:{status:y.button.label,gradeId:d,uuid:t,hintType:r,promptGroup:l,prompt:g.find((e=>e.hintType===r))[l],reflection:y.value}},o,!0)})),"Cancel"===y.button.label?n.exporters.forEach((o=>{n.publishEvent(e,{eventName:"ReflectionCancelled",eventTime:Date.now(),eventInfo:{status:y.button.label,gradeId:d,uuid:t,hintType:r,promptGroup:l,prompt:g.find((e=>e.hintType===r))[l],reflection:y.value}},o,!1)})):(async(e,t,n,o,a,r,s,l,d,c)=>{var u;const p=n.getMetadata("nbgrader").grade_id,g=document.createElement("div");g.id="hint-banner-placeholder",e.content.node.insertBefore(g,e.content.node.firstChild);const b=document.createElement("div");b.id="hint-banner",null===(u=e.content.node.parentElement)||void 0===u||u.insertBefore(b,e.content.node),b.innerHTML='<p><span class="loader"></span>Retrieving hint... Please do not refresh the page.</p> <p>It usually takes around 2 minutes to generate a hint. You may continue to work on the assignment in the meantime.</p>';const v=document.createElement("div");v.id="hint-banner-cancel-button",v.innerText="Cancel request",b.appendChild(v),v.onclick=async()=>{await h("cancel",{method:"POST",body:JSON.stringify({request_id:c})})};const y=o=>{b.remove(),g.remove(),document.getElementById(p).innerText=`Request Hint (${n.getMetadata("remaining_hints")+1} left for this question)`,n.setMetadata("remaining_hints",n.getMetadata("remaining_hints")+1),(0,i.showDialog)({title:"Hint Request Error. Please try again later",buttons:[i.Dialog.createButton({label:"Dismiss",className:"jp-Dialog-button jp-mod-reject jp-mod-styled"})]}),t.exporters.forEach((n=>{t.publishEvent(e,{eventName:"HintRequestError",eventTime:Date.now(),eventInfo:{gradeId:p,requestId:null==o?void 0:o.message,promptGroup:a,prompt:r,uuid:s,preReflection:l,hintType:d}},n,!1)}))};try{const u=await h("reflection",{method:"POST",body:JSON.stringify({request_id:c,reflection_question:r,reflection_answer:l})});if(console.log("Sent reflection",u),!u)throw new Error;{const u=setInterval((async()=>{const f=await h("check",{method:"POST",body:JSON.stringify({request_id:c})});0===f.status?console.log("loading"):1===f.status?(console.log("success"),clearInterval(u),((i,c)=>{const u=n.getMetadata("hintHistory")||[];n.setMetadata("hintHistory",[...u,[d,i]]),t.exporters.forEach((n=>{t.publishEvent(e,{eventName:"HintRequestCompleted",eventTime:Date.now(),eventInfo:{hintContent:i,gradeId:p,requestId:c,promptGroup:a,prompt:r,uuid:s,preReflection:l,hintType:d}},n,!0)})),b.innerText=i,v.remove();const h=document.createElement("div");h.id="hint-banner-buttons-container";const y=document.createElement("div");y.id="hint-banner-buttons";const f=document.createElement("button");f.classList.add("hint-banner-button"),f.innerText="Helpful 👍";const w=document.createElement("button");w.classList.add("hint-banner-button"),w.innerText="Unhelpful 👎";const E=async u=>{t.exporters.forEach((n=>{t.publishEvent(e,{eventName:"HintEvaluated",eventTime:Date.now(),eventInfo:{gradeId:p,requestId:c,hintContent:i,evaluation:u,promptGroup:a,prompt:r,uuid:s,preReflection:l,hintType:d}},n,!0)})),b.remove(),g.remove(),m(n,o,e,t)};f.onclick=()=>{E("helpful")},w.onclick=()=>{E("unhelpful")},y.appendChild(w),y.appendChild(f),h.appendChild(y),b.appendChild(h)})(JSON.parse(f.result).feedback,c)):2===f.status?(console.log("cancelled"),clearInterval(u),(n=>{b.remove(),g.remove(),(0,i.showDialog)({title:"Hint Request Cancelled",buttons:[i.Dialog.createButton({label:"Dismiss",className:"jp-Dialog-button jp-mod-reject jp-mod-styled"})]}),t.exporters.forEach((o=>{t.publishEvent(e,{eventName:"HintRequestCancelled",eventTime:Date.now(),eventInfo:{gradeId:p,requestId:n,promptGroup:a,prompt:r,uuid:s,preReflection:l,hintType:d}},o,!1)}))})(c)):(clearInterval(u),y(new Error(c)))}),1e3)}}catch(e){console.log(e),y(e)}})(e,n,o,a,l,g.find((e=>e.hintType===r))[l],t,y.value,r,v)}var p};class b extends i.ReactWidget{constructor(){super()}getValue(){var e;return null===(e=this.node.querySelector('input[name="hint-info"]:checked'))||void 0===e?void 0:e.value}render(){return d().createElement("div",{className:"hint-info"},"You can request hints of the following types, but keep in mind you are limited in the total number of hints you can request:",d().createElement("div",null,d().createElement("label",null,d().createElement("span",{className:"hint-request-bar-right-request-button planning"},"Planning")," ","A hint aimed at helping you to identify the steps needed to solve the question.")),d().createElement("div",null,d().createElement("label",null,d().createElement("span",{className:"hint-request-bar-right-request-button debugging"},"Debugging")," ","A hint aimed at helping you identify and fix a bug in your current program.")),d().createElement("div",null,d().createElement("label",null,d().createElement("span",{className:"hint-request-bar-right-request-button optimizing"},"Optimizing")," ","A hint aimed at helping you optimize your current program for better performance and readability.")))}}class v extends i.ReactWidget{constructor(){super()}getValue(){var e;return null===(e=this.node.querySelector('input[name="hint-consent"]:checked'))||void 0===e?void 0:e.value}render(){return d().createElement("div",{className:"hint-consent"},d().createElement("p",null,"The hinting features in this notebook are a part of a research prototype developed at the University of Michigan with the purpose of supporting your learning. It is completely optional to use these features, press cancel if you do not wish to use this prototype."),d().createElement("p",null,"When you request a hint this prototype takes your notebook, as well as other contextual information you might provide, and uses external/third party large language model services for analysis. Hints may be incorrect, incomplete, or misleading, and you are encouraged to critically evaluate responses before modifying your program."),d().createElement("p",null,"If you have questions about the system, contact Dr. Christopher Brooks (brooksch@umich.edu)."))}}const y={id:"hintbot:plugin",description:"A JupyterLab extension.",autoStart:!0,requires:[a.INotebookTracker,o.ISettingRegistry,r.IJupyterLabPioneer],activate:async(e,t,n,o)=>{const a=await n.load(y.id);t.widgetAdded.connect((async(e,t)=>{await t.revealed,await o.loadExporters(t),await(async(e,t,n)=>{var o,a,r,s;const l=t.get("hintQuantity").composite,d=null===(o=e.content.model)||void 0===o?void 0:o.cells,c=async(t,o,a)=>{if(!0===e.model.getMetadata("firstTimeUsingHintbot")){const t=await(0,i.showDialog)({body:new v,buttons:[i.Dialog.cancelButton({label:"Cancel",className:"jp-mod-reject jp-mod-styled"}),i.Dialog.createButton({label:"Consent and request hint",className:"jp-mod-accept jp-mod-styled"})],hasClose:!1});if("Cancel"===t.button.label)return;n.exporters.forEach((o=>{n.publishEvent(e,{eventName:"FirstTimeUsingHintbot",eventTime:Date.now(),eventInfo:{status:t.button.label}},o,!1)})),e.model.setMetadata("firstTimeUsingHintbot",!1)}g(e,0,n,t,o,a)},u=(t,o,a)=>{const r=document.createElement("div");r.classList.add("hint-request-bar");const s=document.createElement("div");s.classList.add("hint-request-bar-left");const l=document.createElement("div");l.classList.add("hint-request-bar-left-text"),l.id=t.getMetadata("nbgrader").grade_id,s.appendChild(l),void 0===t.getMetadata("remaining_hints")?(t.setMetadata("remaining_hints",a),l.innerText=`Request Hint (${a} left for this question)`):l.innerText=`Request Hint (${t.getMetadata("remaining_hints")} left for this question)`;const d=document.createElement("button");d.classList.add("hint-request-bar-left-info-button"),d.innerText=" ? ",d.onclick=()=>{(0,i.showDialog)({body:new b,buttons:[i.Dialog.createButton({label:"Dismiss",className:"jp-Dialog-button jp-mod-reject jp-mod-styled"})]}),n.exporters.forEach((t=>{n.publishEvent(e,{eventName:"HintTypeReview",eventTime:Date.now()},t,!1)}))},s.appendChild(d);const u=document.createElement("div");u.classList.add("hint-request-bar-right");const p=document.createElement("button");p.innerText="Planning",p.classList.add("hint-request-bar-right-request-button","planning"),p.onclick=()=>c(t,o,"planning");const h=document.createElement("button");h.innerText="Debugging",h.classList.add("hint-request-bar-right-request-button","debugging"),h.onclick=()=>c(t,o,"debugging");const m=document.createElement("button");return m.innerText="Optimizing",m.classList.add("hint-request-bar-right-request-button","optimizing"),m.onclick=()=>c(t,o,"optimizing"),u.appendChild(p),u.appendChild(h),u.appendChild(m),r.appendChild(s),r.appendChild(u),r};if(void 0===e.model.getMetadata("firstTimeUsingHintbot")&&e.model.setMetadata("firstTimeUsingHintbot",!0),d)for(let t=0;t<d.length;t++)if(d.get(t).getMetadata("nbgrader")&&"markdown"===(null===(a=d.get(t).getMetadata("nbgrader"))||void 0===a?void 0:a.cell_type)&&(null===(r=d.get(t).getMetadata("nbgrader"))||void 0===r?void 0:r.grade_id)&&!["cell-d4da7eb9acee2a6d","cell-a839e7b47494b4c2","cell-018440ed2f1b6a62","cell-018440eg2f1b6a62"].includes(null===(s=d.get(t).getMetadata("nbgrader"))||void 0===s?void 0:s.grade_id)){const o=u(d.get(t),t,l);e.content.widgets[t].node.appendChild(o),m(d.get(t),t,e,n)}})(t,a,o)}))}},f=y}}]);