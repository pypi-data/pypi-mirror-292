(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[318],{79826:function(e,t,a){Promise.resolve().then(a.bind(a,86741))},78797:function(e,t,a){"use strict";a.d(t,{h:function(){return v}});var s=a(57437),n=a(16463),r=a(2265),o=a(67397),l=a(44390),c=a(44839),i=a(6920),u=a(1970);let d=e=>(0,s.jsxs)("div",{className:"flex flex-row",children:[(0,s.jsxs)("div",{className:"text-gray-500",children:[(0,s.jsx)(i.G,{icon:u.cC_,className:"h-[12px] mr-1"}),(0,s.jsx)("span",{children:e.label})]}),(0,s.jsx)("div",{className:"ml-auto",children:(0,s.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:e.options.length})})]}),h=e=>{let{value:t,label:a,description:n}=e;return(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{children:a}),(0,s.jsx)("div",{className:"text-gray-500",children:n})]})},m={control:{base:"flex border rounded-md bg-input hover:cursor-pointer min-w-[100px] !min-h-[36px] w-[100%] h-[100%] text-foreground text-foreground",focus:"",nonFocus:"border-border"},option:{base:"hover:cursor-pointer px-3 py-2 rounded flex gap-2 items-center hover:bg-muted !text-sm",focus:"bg-[rgba(var(--primary),0.1)]",selected:"bg-[rgba(var(--primary),0.3)] hover:bg-[rgba(var(--primary),0.3)] text-primary font-bold"}},p={control:e=>{let{isFocused:t}=e;return(0,c.W)(t?m.control.focus:m.control.nonFocus,m.control.base)},option:e=>{let{isSelected:t,isFocused:a}=e;return(0,c.W)(m.option.base,t?m.option.selected:"",a?m.option.focus:"")},menu:()=>"p-1 mt-1 bg-white rounded-md shadow-md",placeholder:()=>"text-placeholder pl-1",input:()=>"text-foreground pl-1",valueContainer:()=>"p-1 gap-1",singleValue:()=>"pl-1",multiValue:()=>"flex bg-[rgba(var(--primary),0.15)] p-0 pl-2 rounded-sm text-xs overflow-hidden",multiValueLabel:()=>"py-1",multiValueRemove:()=>"bg-[rgba(var(--primary),0.1)] hover:bg-[rgba(var(--primary),0.2)] text-primary px-1 ml-2",indicatorsContainer:()=>"p-1 gap-1",clearIndicator:()=>"text-muted-foreground px-1 hover:text-error",indicatorSeparator:()=>"bg-border",dropdownIndicator:()=>"p-1 hover:bg-muted text-muted-foreground rounded-md hover:text-foreground",groupHeading:()=>"ml-3 mt-2 mb-1 text-muted-foreground text-sm",noOptionsMessage:()=>"text-placeholder py-3"},x=e=>{let{options:t,className:a,isMulti:n=!1,value:i,onChange:u,useFormatOptionLabel:m=!1}=e;return(0,s.jsx)(o.ZP,{instanceId:(0,r.useId)(),unstyled:!0,options:t,isMulti:n,value:i,onChange:u,classNames:{...p},className:(0,c.W)(a),formatGroupLabel:d,formatOptionLabel:m?h:void 0,components:{Input:e=>(0,s.jsx)(l.c.Input,{...e,"aria-activedescendant":void 0})}})};var b=a(45079),g=a(71165),f=a(20357);let v=e=>{let{handleFetchData:t}=e,[a,o]=(0,r.useState)("/cl"),[l,c]=(0,r.useState)([]),[u,d]=(0,r.useState)([]),[h,m]=(0,r.useState)([]),[p,v]=(0,r.useState)("obt"),[j,w]=(0,r.useState)("obt_sales_order"),[y,N]=(0,r.useState)("week_ver"),k=(0,g.o)(e=>e.loading),C=(0,g.o)(e=>e.setLoading),L=(0,n.useRouter)(),S=(0,n.usePathname)(),P=(0,n.useSearchParams)(),_=(0,r.useCallback)(async()=>{let e=f.env.NEXT_PUBLIC_API_HOSTNAME||"",t=await fetch("".concat(e,"/api/v1/schemas")),a=await t.json();return c(a),a},[]),E=(0,r.useCallback)(async e=>{let t=new URLSearchParams({schema:e}),a=f.env.NEXT_PUBLIC_API_HOSTNAME||"",s=await fetch("".concat(a,"/api/v1/sources?").concat(t)),n=await s.json();return d(n),n},[p]),R=(0,r.useCallback)(async(e,t)=>{let a=new URLSearchParams({schema:e,source:t}),s=f.env.NEXT_PUBLIC_API_HOSTNAME||"",n=await fetch("".concat(s,"/api/v1/columns?").concat(a)),r=await n.json();return m(r),r},[p,j]),T=(0,r.useCallback)(async function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];v(e);let a=(await E(e))[0].options[0].value;if(w(a),t){let t=await R(e,a);t&&N(t[0].value)}},[p]),I=(0,r.useCallback)(async function(e,t){let a=!(arguments.length>2)||void 0===arguments[2]||arguments[2];w(t);let s=await R(e,t);a&&s&&N(s[0].value)},[p,j]),A=(0,r.useCallback)(()=>{let e=new URLSearchParams({schema:p,source:j,column:y});L.push("".concat(S,"?").concat(e))},[S,p,j,y]),B=(0,r.useCallback)(async()=>{let e=P.get("schema"),a=P.get("source"),s={schema:e,source:a,column:P.get("column"),depth:P.get("depth")};if(e&&a){C(!0);let e=await t(s);C(!1),e&&(_(),s.schema!=p&&await T(s.schema,!1),s.source!=j&&await I(s.schema,s.source,!1),s.column&&s.column!=y&&N(s.column))}},[S,P]);return(0,r.useEffect)(()=>{P.size&&P.get("schema")!=p&&P.get("source")!=j||(console.log("init"),_(),E(p),R(p,j))},[]),(0,r.useEffect)(()=>{B(),S!=a&&o(S)},[S,P]),(0,s.jsx)("header",{className:"bg-white border-b-[1px]",children:(0,s.jsxs)("nav",{className:"container mr-auto flex flex-wrap flex-col md:flex-row items-center",children:[(0,s.jsx)("a",{className:"flex title-font font-medium items-center text-gray-900 mb-4 md:mb-0",children:(0,s.jsx)("span",{className:"ml-3 text-xl",children:(0,s.jsxs)("select",{value:a,onChange:e=>L.push(e.target.value),children:[(0,s.jsx)("option",{value:"/cte",children:"CTE Lineage"}),(0,s.jsx)("option",{value:"/cl",children:"Column Level Lineage"})]})})}),(0,s.jsxs)("nav",{className:"md:mr-auto md:ml-4 md:py-2 md:pl-4 md:border-l md:border-gray-400 flex flex-wrap items-center text-base justify-center",children:[(0,s.jsx)(x,{value:{label:p,value:p},options:l,className:"mr-2 w-[15vw]",onChange:e=>T(e.value)}),(0,s.jsx)(x,{value:{label:j,value:j},options:u,className:"mr-2 w-[30vw]",onChange:e=>I(p,e.value)}),h&&(0,s.jsx)(x,{value:{label:y,value:y},options:h,className:"mr-2 w-[15vw]",useFormatOptionLabel:!0,onChange:e=>N(e.value)}),(0,s.jsx)("button",{type:"button",className:"border-[1px] border-blue-400 px-3 py-1.5 bg-blue-400 text-s text-white font-semibold rounded hover:bg-blue-500",onClick:e=>A(),children:k?(0,s.jsx)(i.G,{icon:b.LM3,spinPulse:!0}):(0,s.jsx)("span",{children:"Submit"})})]}),(0,s.jsx)("div",{className:"ml-auto"})]})})}},86741:function(e,t,a){"use strict";a.d(t,{Cte:function(){return L}});var s=a(57437),n=a(16463),r=a(27289),o=a(2265),l=a(6785),c=a(63775),i=a(50197);a(10715);var u=a(78797),d=a(71165),h=a(20707),m=a(20548),p=a(37642),x=a(29820),b=a.n(x),g=a(92168),f=a(19997),v=a(20357);let j=h.Py.define(),w=h.QQ.define({create:()=>h.p.none,update(e,t){for(let a of(e=e.map(t.changes),t.effects))a.is(j)&&(e=e.update({add:a.value,sort:!0}));return e},provide:e=>h.tk.decorations.from(e)}),y=(e,t,a)=>{console.log("rankdir=".concat(a,", layouting..."));let s=new(b()).graphlib.Graph().setDefaultEdgeLabel(()=>({}));return s.setGraph({rankdir:a}),t.forEach(e=>s.setEdge(e.source,e.target)),e.forEach(e=>s.setNode(e.id,{label:e.id,width:150,height:40})),b().layout(s),e.forEach(e=>{let t=s.node(e.id);switch(a){case"TB":e.targetPosition=l.Ly.Top,e.sourcePosition=l.Ly.Bottom;break;case"BT":e.targetPosition=l.Ly.Bottom,e.sourcePosition=l.Ly.Top;break;case"LR":e.targetPosition=l.Ly.Left,e.sourcePosition=l.Ly.Right;break;case"RL":e.targetPosition=l.Ly.Right,e.sourcePosition=l.Ly.Left}return e.position={x:t.x-75,y:t.y-20},e}),{nodes:e,edges:t}},N=e=>{let{columns:t}=e;return(0,s.jsxs)("table",{className:"table-auto text-xs w-full",children:[(0,s.jsx)("thead",{className:"sticky top-0 z-10",children:(0,s.jsxs)("tr",{className:"bg-gray-200",children:[(0,s.jsx)("th",{className:"border",children:"Column"}),(0,s.jsx)("th",{className:"border",children:"Type"}),(0,s.jsx)("th",{className:"border",children:"Description"})]})}),(0,s.jsx)("tbody",{children:Object.keys(t).map((e,a)=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"border",children:t[e].name.toLowerCase()}),(0,s.jsx)("td",{className:"border",children:t[e].type}),(0,s.jsx)("td",{className:"border",children:t[e].comment})]},a))})]})};function k(e,t){let a=new m.FH(e.state.doc,t);return(a.next(),0==a.value.from)?null:a.value}let C=e=>{let{nodes:t,edges:a,setNodes:r,setEdges:u,nodesPositioned:m,setNodesPositioned:p,codeMirrorRef:x,setMode:b,lineageTableColumns:g}=e,f=(0,o.useRef)(!0),{fitView:v}=(0,l._K)(),w=(0,n.useRouter)(),N=(0,n.useSearchParams)(),[C,L]=(0,o.useState)(!1),[S,P]=(0,o.useState)(!1),_=(0,d.o)(e=>e.options),E=(0,d.o)(e=>e.setOptions),R=(0,o.useCallback)(async e=>{E({rankdir:e}),p(!1)},[N]),T=(0,o.useCallback)((e,t,a)=>{let s=new URLSearchParams({schema:e,source:t});a&&s.set("column",a),w.push("/cte?".concat(s.toString()))},[N]),I=(0,o.useCallback)(e=>{if(b("query"),null==x.current||null==x.current.view)return;if(null!=e.data.db){T(e.data.db,e.data.table,e.data.column);return}let t=x.current.view,a=k(t,"".concat(e.data.label," as ("));a&&(null==t||t.dispatch({selection:{head:a.from,anchor:a.to},scrollIntoView:!0,effects:h.tk.scrollIntoView(a.from,{x:"start",y:"start"})}))},[N]),A=(0,o.useCallback)(e=>t=>(("input"===t.type||t.has_db)&&(t.hidden=e),t),[]),B=(0,o.useCallback)(e=>{P(e),console.log("hidden=".concat(e)),p(!1)},[]),O=(0,o.useCallback)(()=>{if(0==t.length||m)return;console.log("nodes.length == ".concat(t.length,", nodesPositioned=").concat(m));let e=y(t,a,_.rankdir);r([...e.nodes].map(A(S))),u([...e.edges].map(A(S))),window.requestAnimationFrame(()=>{setTimeout(()=>v(),0)}),L(!0),p(!0)},[m]),U=(0,o.useCallback)(e=>r(t=>(0,l.Fb)(e,t)),[r]),M=(0,o.useCallback)(e=>u(t=>(0,l.yn)(e,t)),[u]),F=(0,o.useCallback)(e=>u(t=>(0,l.Z_)(e,t)),[u]);return(0,o.useEffect)(()=>{if(0==t.length||m||null==x.current||null==x.current.view)return;let e=[],a=h.p.mark({class:"bg-yellow-200"});for(let t in console.log(g),g){let s=g[t];for(let t of s.columns){let n="".concat(s.alias,".").concat(t)||"",r=k(x.current.view,n);r&&e.push(a.range(r.from,r.to))}let n="".concat(s.db,".").concat(t)||"",r=k(x.current.view,n);r&&e.push(a.range(r.from,r.to))}console.log(e),x.current.view.dispatch({effects:j.of(e)})},[m,x.current]),(0,o.useEffect)(()=>{f.current||O()},[m]),(0,o.useEffect)(()=>{E({rankdir:"TB"}),f.current=!1},[]),(0,s.jsx)(o.Suspense,{children:(0,s.jsxs)(l.x$,{nodes:t,edges:a,onNodesChange:U,onEdgesChange:M,onConnect:F,onNodeClick:(e,t)=>I(t),children:[(0,s.jsxs)(l.s_,{position:"top-right",children:[(0,s.jsx)("div",{children:(0,s.jsxs)("select",{value:_.rankdir,onChange:e=>R(e.target.value),children:[(0,s.jsx)("option",{value:"LR",children:"Left - Right"}),(0,s.jsx)("option",{value:"RL",children:"Right - Left"}),(0,s.jsx)("option",{value:"TB",children:"Top - Bottom"}),(0,s.jsx)("option",{value:"BT",children:"Bottom - Top"})]})}),(0,s.jsx)("div",{children:(0,s.jsxs)("label",{htmlFor:"ishidden",children:[(0,s.jsx)("input",{id:"ishidden",type:"checkbox",checked:S,onChange:e=>B(e.target.checked)}),"Hide source table"]})})]}),(0,s.jsx)(c.Z,{}),(0,s.jsx)(i.A,{style:{backgroundColor:"#f5f5f5"}})]})})},L=()=>{let{height:e,width:t}=(0,r.Y)(),[a,c]=(0,l.Rr)([]),[i,d]=(0,l.ll)([]),[m,x]=(0,o.useState)(!0),b=(0,o.useRef)(null),[j,y]=(0,o.useState)("query"),[k,L]=(0,o.useState)(""),[S,P]=(0,o.useState)(""),[_,E]=(0,o.useState)(""),[R,T]=(0,o.useState)(""),[I,A]=(0,o.useState)([]),[B,O]=(0,o.useState)({}),U=(0,n.useRouter)(),M=(0,o.useCallback)(async e=>{let{source:t,column:s}=e;0!=a.length&&(c([]),d([]));let n=new URLSearchParams({source:t,column:s}),r=v.env.NEXT_PUBLIC_API_HOSTNAME||"",o=await fetch("".concat(r,"/api/v1/cte?").concat(n)),l=await o.json();return 200!=o.status?(alert(l.error),U.back(),!1):(console.log(l),c(l.nodes),d(l.edges),L(l.table_name),P(l.materialized),E(l.query),T(l.description),A(l.columns),O(l.lineage_table_columns),x(!1),!0)},[U]);return(0,s.jsxs)("div",{children:[(0,s.jsx)(u.h,{handleFetchData:M}),(0,s.jsxs)("div",{className:"flex flex-wrap",children:[(0,s.jsxs)("div",{className:"w-1/2",children:[(0,s.jsxs)("h4",{className:"px-1 text-2xl font-bold",children:[(0,s.jsx)("span",{children:k}),(0,s.jsx)("small",{className:"ms-2 font-semibold text-gray-500 dark:text-gray-400",children:S})]}),(0,s.jsxs)("div",{className:"mx-2",children:[(0,s.jsx)("button",{className:"px-1 "+("description"==j&&"font-semibold"),onClick:()=>y("description"),children:"Description"}),(0,s.jsx)("button",{className:"px-1 "+("columns"==j&&"font-semibold"),onClick:()=>y("columns"),children:"Columns"}),(0,s.jsx)("button",{className:"px-1 "+("query"==j&&"font-semibold"),onClick:()=>y("query"),children:"Query"})]}),(0,s.jsxs)("div",{className:"px-2",style:{height:.85*e,overflowY:"auto"},children:["description"==j&&(0,s.jsx)(g.U,{className:"markdown",remarkPlugins:[f.Z],children:R}),"columns"==j&&(0,s.jsx)(N,{columns:I}),"query"==j&&(0,s.jsx)(h.ZP,{ref:b,value:_,extensions:[(0,p.i6)(),w]})]})]}),(0,s.jsx)("div",{className:"w-1/2",style:{height:e-55},children:(0,s.jsx)(l.tV,{children:(0,s.jsx)(C,{nodes:a,edges:i,setNodes:c,setEdges:d,codeMirrorRef:b,nodesPositioned:m,setNodesPositioned:x,setMode:y,lineageTableColumns:B})})})]})]})}},27289:function(e,t,a){"use strict";a.d(t,{Y:function(){return n}});var s=a(2265);let n=()=>{let[e,t]=(0,s.useState)({width:0,height:100});return(0,s.useEffect)(()=>{{let e=()=>{t({width:window.innerWidth,height:window.innerHeight})};return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)}},[]),e}},71165:function(e,t,a){"use strict";a.d(t,{o:function(){return s}});let s=(0,a(13e3).Ue)()(e=>({options:{rankdir:"LR"},sidebarActive:!1,loading:!1,setOptions:t=>e({options:t}),setSidebarActive:t=>e({sidebarActive:t}),setLoading:t=>e({loading:t})}))}},function(e){e.O(0,[489,676,780,401,907,985,971,23,744],function(){return e(e.s=79826)}),_N_E=e.O()}]);