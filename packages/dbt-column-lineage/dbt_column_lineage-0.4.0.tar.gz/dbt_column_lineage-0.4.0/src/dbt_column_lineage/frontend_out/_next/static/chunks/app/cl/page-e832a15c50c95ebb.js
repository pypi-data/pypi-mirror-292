(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[863],{38127:function(e,t,a){Promise.resolve().then(a.bind(a,63995))},78797:function(e,t,a){"use strict";a.d(t,{h:function(){return v}});var s=a(57437),o=a(16463),n=a(2265),r=a(67397),i=a(44390),l=a(44839),c=a(6920),d=a(1970);let u=e=>(0,s.jsxs)("div",{className:"flex flex-row",children:[(0,s.jsxs)("div",{className:"text-gray-500",children:[(0,s.jsx)(c.G,{icon:d.cC_,className:"h-[12px] mr-1"}),(0,s.jsx)("span",{children:e.label})]}),(0,s.jsx)("div",{className:"ml-auto",children:(0,s.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:e.options.length})})]}),p=e=>{let{value:t,label:a,description:o}=e;return(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{children:a}),(0,s.jsx)("div",{className:"text-gray-500",children:o})]})},m={control:{base:"flex border rounded-md bg-input hover:cursor-pointer min-w-[100px] !min-h-[36px] w-[100%] h-[100%] text-foreground text-foreground",focus:"",nonFocus:"border-border"},option:{base:"hover:cursor-pointer px-3 py-2 rounded flex gap-2 items-center hover:bg-muted !text-sm",focus:"bg-[rgba(var(--primary),0.1)]",selected:"bg-[rgba(var(--primary),0.3)] hover:bg-[rgba(var(--primary),0.3)] text-primary font-bold"}},x={control:e=>{let{isFocused:t}=e;return(0,l.W)(t?m.control.focus:m.control.nonFocus,m.control.base)},option:e=>{let{isSelected:t,isFocused:a}=e;return(0,l.W)(m.option.base,t?m.option.selected:"",a?m.option.focus:"")},menu:()=>"p-1 mt-1 bg-white rounded-md shadow-md",placeholder:()=>"text-placeholder pl-1",input:()=>"text-foreground pl-1",valueContainer:()=>"p-1 gap-1",singleValue:()=>"pl-1",multiValue:()=>"flex bg-[rgba(var(--primary),0.15)] p-0 pl-2 rounded-sm text-xs overflow-hidden",multiValueLabel:()=>"py-1",multiValueRemove:()=>"bg-[rgba(var(--primary),0.1)] hover:bg-[rgba(var(--primary),0.2)] text-primary px-1 ml-2",indicatorsContainer:()=>"p-1 gap-1",clearIndicator:()=>"text-muted-foreground px-1 hover:text-error",indicatorSeparator:()=>"bg-border",dropdownIndicator:()=>"p-1 hover:bg-muted text-muted-foreground rounded-md hover:text-foreground",groupHeading:()=>"ml-3 mt-2 mb-1 text-muted-foreground text-sm",noOptionsMessage:()=>"text-placeholder py-3"},h=e=>{let{options:t,className:a,isMulti:o=!1,value:c,onChange:d,useFormatOptionLabel:m=!1}=e;return(0,s.jsx)(r.ZP,{instanceId:(0,n.useId)(),unstyled:!0,options:t,isMulti:o,value:c,onChange:d,classNames:{...x},className:(0,l.W)(a),formatGroupLabel:u,formatOptionLabel:m?p:void 0,components:{Input:e=>(0,s.jsx)(i.c.Input,{...e,"aria-activedescendant":void 0})}})};var g=a(45079),b=a(71165),f=a(20357);let v=e=>{let{handleFetchData:t}=e,[a,r]=(0,n.useState)("/cl"),[i,l]=(0,n.useState)([]),[d,u]=(0,n.useState)([]),[p,m]=(0,n.useState)([]),[x,v]=(0,n.useState)("obt"),[w,y]=(0,n.useState)("obt_sales_order"),[j,L]=(0,n.useState)("week_ver"),N=(0,b.o)(e=>e.loading),C=(0,b.o)(e=>e.setLoading),k=(0,o.useRouter)(),S=(0,o.usePathname)(),_=(0,o.useSearchParams)(),P=(0,n.useCallback)(async()=>{let e=f.env.NEXT_PUBLIC_API_HOSTNAME||"",t=await fetch("".concat(e,"/api/v1/schemas")),a=await t.json();return l(a),a},[]),R=(0,n.useCallback)(async e=>{let t=new URLSearchParams({schema:e}),a=f.env.NEXT_PUBLIC_API_HOSTNAME||"",s=await fetch("".concat(a,"/api/v1/sources?").concat(t)),o=await s.json();return u(o),o},[x]),E=(0,n.useCallback)(async(e,t)=>{let a=new URLSearchParams({schema:e,source:t}),s=f.env.NEXT_PUBLIC_API_HOSTNAME||"",o=await fetch("".concat(s,"/api/v1/columns?").concat(a)),n=await o.json();return m(n),n},[x,w]),A=(0,n.useCallback)(async function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];v(e);let a=(await R(e))[0].options[0].value;if(y(a),t){let t=await E(e,a);t&&L(t[0].value)}},[x]),T=(0,n.useCallback)(async function(e,t){let a=!(arguments.length>2)||void 0===arguments[2]||arguments[2];y(t);let s=await E(e,t);a&&s&&L(s[0].value)},[x,w]),I=(0,n.useCallback)(()=>{let e=new URLSearchParams({schema:x,source:w,column:j});k.push("".concat(S,"?").concat(e))},[S,x,w,j]),F=(0,n.useCallback)(async()=>{let e=_.get("schema"),a=_.get("source"),s={schema:e,source:a,column:_.get("column"),depth:_.get("depth")};if(e&&a){C(!0);let e=await t(s);C(!1),e&&(P(),s.schema!=x&&await A(s.schema,!1),s.source!=w&&await T(s.schema,s.source,!1),s.column&&s.column!=j&&L(s.column))}},[S,_]);return(0,n.useEffect)(()=>{_.size&&_.get("schema")!=x&&_.get("source")!=w||(console.log("init"),P(),R(x),E(x,w))},[]),(0,n.useEffect)(()=>{F(),S!=a&&r(S)},[S,_]),(0,s.jsx)("header",{className:"bg-white border-b-[1px]",children:(0,s.jsxs)("nav",{className:"container mr-auto flex flex-wrap flex-col md:flex-row items-center",children:[(0,s.jsx)("a",{className:"flex title-font font-medium items-center text-gray-900 mb-4 md:mb-0",children:(0,s.jsx)("span",{className:"ml-3 text-xl",children:(0,s.jsxs)("select",{value:a,onChange:e=>k.push(e.target.value),children:[(0,s.jsx)("option",{value:"/cte",children:"CTE Lineage"}),(0,s.jsx)("option",{value:"/cl",children:"Column Level Lineage"})]})})}),(0,s.jsxs)("nav",{className:"md:mr-auto md:ml-4 md:py-2 md:pl-4 md:border-l md:border-gray-400 flex flex-wrap items-center text-base justify-center",children:[(0,s.jsx)(h,{value:{label:x,value:x},options:i,className:"mr-2 w-[15vw]",onChange:e=>A(e.value)}),(0,s.jsx)(h,{value:{label:w,value:w},options:d,className:"mr-2 w-[30vw]",onChange:e=>T(x,e.value)}),p&&(0,s.jsx)(h,{value:{label:j,value:j},options:p,className:"mr-2 w-[15vw]",useFormatOptionLabel:!0,onChange:e=>L(e.value)}),(0,s.jsx)("button",{type:"button",className:"border-[1px] border-blue-400 px-3 py-1.5 bg-blue-400 text-s text-white font-semibold rounded hover:bg-blue-500",onClick:e=>I(),children:N?(0,s.jsx)(c.G,{icon:g.LM3,spinPulse:!0}):(0,s.jsx)("span",{children:"Submit"})})]}),(0,s.jsx)("div",{className:"ml-auto"})]})})}},63995:function(e,t,a){"use strict";a.d(t,{Cl:function(){return S}});var s=a(57437),o=a(16463),n=a(6785),r=a(2265),i=a(1970),l=a(6920);let c={left:{left:"-8px"},right:{right:"-8px"},handle:{widht:"10px",height:"10px",margin:"auto",background:"#ddd",borderRadius:"15px",border:"2px solid #ddd",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px 3px 0px, rgba(0, 0, 0, 0.14) 0px 1px 1px 0px, rgba(0, 0, 0, 0.12) 0px 2px 1px -1px"}},d={textAlign:"left"},u={position:"relative",padding:"8px 16px",flexGrow:1},p={body:{display:"flex",flexDirection:"column",backgroundColor:"#fff",transition:"all 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms",boxShadow:"0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23)",border:"0px solid #bbb",fontSize:"10pt"},selected:{boxShadow:"0 14px 28px rgba(0,0,0,0.25), 0 10px 10px rgba(0,0,0,0.22)"},title:{position:"relative",padding:"8px 32px",flexGrow:1,backgroundColor:"#eee"},contentWrapper:{padding:"8px 0px"}};var m=(0,r.memo)(e=>{let{label:t,selected:o,color:n,content:c}=e,d={...p.title};n&&(d.backgroundColor=n);let u=(0,r.useCallback)(async(e,t)=>{await a.g.navigator.clipboard.writeText(t),alert("Copied to clipboard!: "+t)},[]);return(0,s.jsxs)("div",{style:{...p.body,...o?p.selected:[]},children:[(0,s.jsxs)("div",{style:d,children:[(0,s.jsx)("span",{children:t}),(0,s.jsx)(l.G,{onClick:e=>u(e,t),className:"cursor-pointer mx-1 fa-sm",icon:i.kZ_})]}),(0,s.jsx)("div",{style:p.contentWrapper,children:c})]})}),x=a(71165),h=a(45079),g=a(20357);let b=e=>{let{data:t,id:a,selected:o,addReverseLineage:i}=e,p=(0,x.o)(e=>e.options),b=(0,x.o)(e=>e.setLoading),f=(0,n.Bn)(),v=(0,r.useCallback)((e,a)=>{e.stopPropagation();let s=new URLSearchParams({schema:t.schema,source:t.name,column:a.toLowerCase()});window.open("/cte?".concat(s.toString()),"_blank")},[t]),w=(0,r.useCallback)(async(e,t,a,s)=>{e.stopPropagation(),b(!0);let o=new URLSearchParams({source:a,column:s}),n=g.env.NEXT_PUBLIC_API_HOSTNAME||"",r=await fetch("".concat(n,"/api/v1/reverse_lineage?").concat(o)),l=await r.json();i&&i({updateNodeInternals:f,props:l,id:t,source:a,column:s}),b(!1)},[t]);return(0,s.jsx)(m,{label:t.name,selected:o,color:"Lavender",content:(0,s.jsx)(s.Fragment,{children:t.columns.map(e=>(0,s.jsxs)("div",{className:"flex",style:{...u,...d},children:[(0,s.jsx)("p",{className:"cursor-pointer hover:underline",onClick:t=>{v(t,e)},children:e}),!t.last&&(0,s.jsx)(n.HH,{type:"source",position:"LR"==p.rankdir?n.Ly.Right:n.Ly.Left,id:e+"__source",style:{...c.handle,..."LR"==p.rankdir?c.right:c.left}}),!t.first||(null==t?void 0:t.opened)&&t.opened.includes(e)?(0,s.jsx)(n.HH,{type:"target",position:"LR"==p.rankdir?n.Ly.Left:n.Ly.Right,id:e+"__target",style:{...c.handle,..."LR"==p.rankdir?c.left:c.right}}):(0,s.jsx)("p",{className:"ml-auto",children:(0,s.jsx)(l.G,{onClick:s=>w(s,a,t.name,e),className:"cursor-pointer mx-1 fa-sm",icon:h.ccb})})]},"i-"+e))})})};var f=a(27289),v=a(63775),w=a(50197);a(10715);var y=a(29820),j=a.n(y);let L=(e,t,a)=>{let s=new(j()).graphlib.Graph;return s.setDefaultEdgeLabel(()=>({})),s.setGraph(a),t.forEach(e=>s.setEdge(e.source,e.target)),e.forEach(e=>s.setNode(e.id,{label:e.id,width:e.width,height:e.height})),j().layout(s),e.forEach(e=>{let t=s.node(e.id);switch(a.rankdir){case"TB":e.targetPosition=n.Ly.Top,e.sourcePosition=n.Ly.Bottom;break;case"BT":e.targetPosition=n.Ly.Bottom,e.sourcePosition=n.Ly.Top;break;case"LR":e.targetPosition=n.Ly.Left,e.sourcePosition=n.Ly.Right;break;case"RL":e.targetPosition=n.Ly.Right,e.sourcePosition=n.Ly.Left}return e.position={x:t.x-t.width/2+Math.random()/1e3,y:t.y-t.height/2},e}),{nodes:e,edges:t}},N=e=>{let{setNodes:t,setEdges:a,setViewIsFit:i,nodesPositioned:c,setNodesPositioned:d}=e,{fitView:u}=(0,n._K)(),p=(0,n.oR)(e=>e.nodeInternals),m=Array.from(p.values()),g=(0,n.oR)(e=>e.edges),b=(0,n.oR)(e=>e.transform),f=(0,x.o)(e=>e.options),v=(0,x.o)(e=>e.sidebarActive),w=(0,x.o)(e=>e.setSidebarActive),y=(0,o.useRouter)();return(0,r.useCallback)((e,t)=>{let a=new URLSearchParams({schema:e.data.schema,source:e.data.name,column:t});y.push("/cte?".concat(a.toString()))},[p]),(0,r.useEffect)(()=>{try{var e;if((null===(e=m[0])||void 0===e?void 0:e.width)&&m.length>0&&!c){let e=L(m,g,f);console.log("redraw",e),t(e.nodes),a(e.edges),d(!0),window.requestAnimationFrame(()=>{setTimeout(()=>u(),0)}),i(!0)}}catch(e){console.log("error",e)}},[c,m]),(0,s.jsxs)("div",{className:"bg-white drop-shadow-md "+(v?"w-1/6":"w-5"),children:[(0,s.jsx)("div",{className:"px-1",onClick:()=>w(!v),children:(0,s.jsx)(l.G,{icon:v?h.yOZ:h.EyR,className:"h-[20px]"})}),v&&(0,s.jsxs)("div",{className:"px-2 text-sm",children:[(0,s.jsx)("div",{className:"py-1 font-semibold text-base",children:"Zoom & pan transform"}),(0,s.jsxs)("div",{className:"transform break-words",children:["[",b[0].toFixed(2),", ",b[1].toFixed(2),", ",b[2].toFixed(2),"]"]}),(0,s.jsx)("div",{className:"py-1 font-semibold text-base",children:"Nodes"}),m.map(e=>(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium break-words",children:e.data.name}),(0,s.jsxs)("div",{children:["x: ",e.position.x.toFixed(2),", y: ",e.position.y.toFixed(2)]})]},e.id))]})]})};var C=a(78797),k=a(20357);let S=()=>{let{height:e,width:t}=(0,f.Y)(),[a,i]=(0,n.Rr)([]),[l,c]=(0,n.Rr)([]),[d,u]=(0,n.ll)([]),[p,m]=(0,r.useState)(!1),[h,g]=(0,r.useState)(!0),y=(0,x.o)(e=>e.sidebarActive),j=(0,x.o)(e=>e.options),L=(0,x.o)(e=>e.setOptions),S=(0,o.useSearchParams)(),_=(0,r.useCallback)(async e=>{let{source:t,column:s,m:o}=e;0!=a.length&&(i([]),u([]));let n=new URLSearchParams({source:t,column:s}),r=k.env.NEXT_PUBLIC_API_HOSTNAME||"",p=await fetch("".concat(r,"/api/v1/lineage?").concat(n)),m=await p.json();if(200!=p.status)return alert(m.error),!1;if("a"==o){let e=[...l,...m.nodes.filter(e=>e.data.name!=t)],a=[...d,...m.edges];i(e),u(a),c(e)}else i(m.nodes),u(m.edges),c(m.nodes);return g(!1),!0},[S]),P=(0,r.useCallback)(async e=>{let{updateNodeInternals:t,props:a,id:s,source:o,column:r}=e,l=new Set;for(let e of(i(e=>e.map(e=>{if(e.data.name==o){let t=e.data.opened||[];t.push(r),e.data={...e.data,opened:t}}let t=a.nodes.find(t=>t.data.name==e.data.name);if(t){let a=new Set(e.data.columns);for(let e of t.data.columns)a.add(e);e.data.columns=Array.from(a),l.add(e.data.name)}return e})),t(s),a.nodes))l.has(e.data.name)||i(t=>t.concat(e));for(let e of a.edges)u(t=>(0,n.Z_)(e,t));setTimeout(()=>g(!1),100)},[a,d]),R=(0,r.useCallback)(async e=>{L({rankdir:e}),g(!1)},[S]),E=(0,r.useCallback)(e=>i(t=>(0,n.Fb)(e,t)),[i]),A=(0,r.useCallback)(e=>u(t=>(0,n.yn)(e,t)),[u]),T=(0,r.useCallback)(e=>u(t=>(0,n.Z_)(e,t)),[u]);(0,r.useEffect)(()=>{g(!1)},[y]),(0,r.useEffect)(()=>{L({rankdir:"RL"})},[]);let I=(0,r.useMemo)(()=>({eventNode:e=>(0,s.jsx)(b,{addReverseLineage:P,...e})}),[]);return(0,s.jsxs)("div",{children:[(0,s.jsx)(C.h,{handleFetchData:_}),(0,s.jsx)("div",{className:"flex flex-wrap",children:(0,s.jsxs)(n.tV,{children:[(0,s.jsx)("div",{className:y?"w-5/6":"w-[calc(100%-20px)]",style:{height:e-55},children:(0,s.jsxs)(n.x$,{nodes:a,edges:d,onNodesChange:E,onEdgesChange:A,onConnect:T,nodeTypes:I,children:[(0,s.jsx)(n.s_,{position:"top-left",children:(0,s.jsxs)("select",{value:j.rankdir,onChange:e=>R(e.target.value),children:[(0,s.jsx)("option",{value:"LR",children:"Left - Right"}),(0,s.jsx)("option",{value:"RL",children:"Right - Left"})]})}),(0,s.jsx)(v.Z,{}),(0,s.jsx)(w.A,{style:{backgroundColor:"#f5f5f5"}})]})}),(0,s.jsx)(N,{setNodes:i,setEdges:u,setViewIsFit:m,setNodesPositioned:g,nodesPositioned:h})]})})]})}},27289:function(e,t,a){"use strict";a.d(t,{Y:function(){return o}});var s=a(2265);let o=()=>{let[e,t]=(0,s.useState)({width:0,height:100});return(0,s.useEffect)(()=>{{let e=()=>{t({width:window.innerWidth,height:window.innerHeight})};return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)}},[]),e}},71165:function(e,t,a){"use strict";a.d(t,{o:function(){return s}});let s=(0,a(13e3).Ue)()(e=>({options:{rankdir:"LR"},sidebarActive:!1,loading:!1,setOptions:t=>e({options:t}),setSidebarActive:t=>e({sidebarActive:t}),setLoading:t=>e({loading:t})}))}},function(e){e.O(0,[489,676,780,907,971,23,744],function(){return e(e.s=38127)}),_N_E=e.O()}]);