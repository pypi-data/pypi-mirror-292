import{h as z,i as Q,r as $,o as r,c as u,b as c,F as L,j as F,k as fe,d as s,w as E,t as M,n as P,l as o,m as ge,v as pe,q as be,s as N,f as he,x as ye,y as v,z as I,A as ve,B as _e,C as ke,D as j,E as we,G as xe,H as w,I as $e,J as i,P as U,K as Ve,L as B,M as Ce,N as Se,O as Te,Q as je,R as Ue,S as Ee,T as Le}from"./DbTgESvQ.js";import{r as ze}from"./CaMo12fb.js";import{_ as Re,a as Be,b as Ie}from"./Dk2ncSqI.js";import{r as Me,_ as Ne,a as De,b as Oe,c as qe}from"./BkF6Vqx3.js";import{_ as Pe}from"./CoLc1c7O.js";import{T as Je,_ as Qe}from"./BuZcmfLY.js";import{_ as Fe}from"./De8JykNN.js";import{u as He}from"./C-G9LxTU.js";import"./C3V0pIhk.js";const Ke={class:"mb-4"},We={class:"hidden sm:block"},Ae={class:"relative rounded-lg shadow flex divide-x divide-gray-200 dark:divide-gray-700","aria-label":"Tabs"},Ge=["onMouseup"],Xe=["onClick"],Ye={class:"absolute right-[1em] focus:outline-none"},Ze=c("span",{"aria-hidden":"true",class:"absolute inset-x-0 bottom-0 h-0.5 bg-transparent dark:bg-gray-600"},null,-1),et=z({__name:"BacktestTabs",props:{tabs:{},currentTab:{}},emits:["close"],setup(V,{emit:n}){const m=Q(),h=$(m.params.id),d=n;function f(l){if(!l.form.routes.length)return"New Tab";if(l.results.exception.error&&l.results.executing)return"Error";const b=l.form.routes[0];let g="";return b.strategy&&(g+=`${b.strategy} • `),b.symbol&&(g+=`${b.symbol} • `),b.timeframe&&(g+=`${b.timeframe}`),g=g.endsWith(" • ")?g.slice(0,-3):g,l.results.executing?`${g} | ${l.results.progressbar.current}%`:l.results.showResults?`${g} | Results`:g}return(l,b)=>{const g=he;return r(),u("div",Ke,[c("div",We,[c("nav",Ae,[(r(!0),u(L,null,F(l.tabs,p=>(r(),u("div",{key:p.id,class:"relative group min-w-0 flex-1 overflow-hidden text-center flex items-center",onMouseup:fe(y=>d("close",p.id),["middle"])},[s(g,{to:`/backtest/${p.id}`,class:P([p.id===o(h)?"text-gray-900 dark:text-gray-100 font-bold ":"text-gray-500 dark:text-gray-300 hover:text-gray-700 font-medium ","py-3 px-4 inline-block select-none cursor-pointer focus:outline-none w-full text-xs bg-gray-50 dark:bg-backdrop-dark"])},{default:E(()=>[c("span",null,M(f(p)),1),c("span",{"aria-hidden":"true",class:P([p.id===o(h)&&Object.keys(l.tabs).length>1?"bg-indigo-400":"bg-transparent dark:bg-gray-600","absolute inset-x-0 bottom-0 h-0.5"])},null,2)]),_:2},1032,["to","class"]),ge(c("button",{class:"absolute right-[1em] focus:outline-none",onClick:y=>d("close",p.id)},[s(o(be),{class:"h-5 w-5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 hover:bg-gray-200 bg-gray-100 dark:bg-gray-700 rounded-full","aria-hidden":"true"})],8,Xe),[[pe,Object.keys(l.tabs).length>1]])],40,Ge))),128)),c("div",{class:"select-none cursor-pointer text-gray-400 dark:text-gray-100 hover:text-gray-600 focus:outline-none group relative w-14 overflow-hidden bg-gray-50 dark:bg-backdrop-dark py-3 px-4 font-medium hover:bg-white dark:hover:bg-gray-800 flex items-center justify-center",onClick:b[0]||(b[0]=p=>o(N)().addTab(l.currentTab))},[c("button",Ye,[s(o(ze),{class:"h-6 w-6 rounded-full","aria-hidden":"true"})]),Ze])])])])}}}),J={width:800,height:400,priceScale:{borderColor:"rgba(197, 203, 206, 1)"},timeScale:{borderColor:"rgba(197, 203, 206, 1)",timeVisible:!0,secondsVisible:!1}},tt={chart:{layout:{background:{color:"#ffffff"},textColor:"rgba(33, 56, 77, 1)"},grid:{vertLines:{color:"#f1f1f1",visible:!0},horzLines:{color:"#f1f1f1",visible:!0}},priceScale:{borderColor:"rgba(197, 203, 206, 0.6)"},timeScale:{borderColor:"rgba(197, 203, 206, 0.6)",timeVisible:!0,secondsVisible:!1}}},st={chart:{layout:{background:{color:"#333333"},textColor:"#D1D5DB"},grid:{vertLines:{color:"#525252",visible:!0},horzLines:{color:"#525252",visible:!0}},priceScale:{borderColor:"#525252"},timeScale:{borderColor:"#525252",timeVisible:!0,secondsVisible:!1}}},ot={class:"mt-2"},rt={class:"ml-2"},lt=z({__name:"EquityCurve",props:{data:{}},setup(V){const n=ye(),m=v(()=>n.value),h=$();let d=null,f=[];const l=V;I(l.data,y=>{}),I(m,y=>{p(y)}),ve(async()=>{await b()});async function b(){J.width=h.value.clientWidth,d=Je(h.value,J);for(const y of l.data){const C=d.addLineSeries({lineWidth:2});C.setData(y.data),f.push(C)}d.timeScale().fitContent(),p(m.value)}_e(()=>{g()});function g(){d!==null&&(d.remove(),d=null),f&&(f=[])}function p(y){d===null||f===null||d.applyOptions(y==="light"?tt.chart:st.chart)}return(y,C)=>(r(),u(L,null,[c("div",{ref_key:"chartContainer",ref:h,class:"rounded overflow-hidden border-2 border-gray-100 dark:border-gray-600"},null,512),c("div",ot,[(r(!0),u(L,null,F(y.data,S=>(r(),u("span",{key:S.name,class:"text-xs mr-2 rounded bg-white dark:bg-gray-700 p-1"},[c("span",{class:"inline-block",style:ke({backgroundColor:S.color,width:"25px",height:"10px"})},null,4),c("span",rt,M(S.name),1)]))),128))])],64))}}),at=["value"],nt={key:1,class:"flex flex-col items-center justify-center select-none mt-[10%]"},it=["textContent"],ut={class:"mt-8"},dt={class:"mt-8"},ct={class:"mt-4"},mt=["href"],ft={key:1,class:"mx-auto container mt-8"},gt={key:0},pt={class:"flex items-center select-none flex-1 my-4"},bt={class:"grid grid-cols-1 gap-6 mt-8"},ht={key:1,class:"w-full mx-auto"},yt={key:4,class:"text-yellow-500 border-yellow-400 bg-yellow-50 dark:bg-gray-700 dark:text-yellow-400 mt-16 text-center text-2xl rounded border-2 border-dashed dark:border-gray-800 py-16 select-none"},vt={key:0},_t={key:0},kt=["href"],wt=["href"],xt=["href"],$t=["href"],Vt=["href"],Ct=["href"],St={key:6,class:"my-4"},Tt={key:1},jt=z({__name:"BacktestTab",props:{form:{},results:{}},setup(V){const n=V,m=$([]),h=$(!1),d=$(!1),f=j().authToken,l=$(we().public.apiBaseUrl),b=N(),g=v(()=>j().jesseSupportedTimeframes.map(e=>({label:e,value:e}))),p=$([]);async function y(){p.value=await j().getExchangeSupportedSymbols(n.form.exchange);for(let e=0;e<n.form.routes.length;e++)p.value.includes(n.form.routes[e].symbol)||(n.form.routes[e].symbol=p.value[0]);if(n.form.data_routes.length>0)for(let e=0;e<n.form.data_routes.length;e++)p.value.includes(n.form.data_routes[e].symbol)||(n.form.data_routes[e].symbol=p.value[0])}n.form.exchange=n.form.exchange||j().backtestingExchangeNames[0],y();const{cancel:C,rerun:S,newBacktest:H}=b;function K(e){if(m.value.length){for(let t=0;t<m.value.length;t++)B("error",m.value[t]);return}b.start(e)}const W=e=>{if(m.value.length){for(let t=0;t<m.value.length;t++)B("error",m.value[t]);return}b.startInNewTab(e)},A=v(()=>{let e=`/download/backtest/chart/${n.results.generalInfo.session_id}?token=${f}`;return l.value!=="/"&&(e=l.value+e),e}),D=v(()=>{let e=`/download/backtest/log/${n.results.generalInfo.session_id}?token=${f}`;return l.value!=="/"&&(e=l.value+e),e}),G=v(()=>{let e=`/download/backtest/tradingview/${n.results.generalInfo.session_id}?token=${f}`;return l.value!=="/"&&(e=l.value+e),e}),X=v(()=>{let e=`/download/backtest/full-reports/${n.results.generalInfo.session_id}?token=${f}`;return l.value!=="/"&&(e=l.value+e),e}),Y=v(()=>{let e=`/download/backtest/csv/${n.results.generalInfo.session_id}?token=${f}`;return l.value!=="/"&&(e=l.value+e),e}),Z=v(()=>{let e=`/download/backtest/json/${n.results.generalInfo.session_id}?token=${f}`;return l.value!=="/"&&(e=l.value+e),e}),k=v(()=>n.results.metrics.length>0),ee=v(()=>xe.remainingTimeText(n.results.progressbar.estimated_remaining_seconds));function te(){navigator.clipboard.writeText(n.results.infoLogs),B("success","Logs copied successfully"),d.value=!0,setTimeout(()=>{d.value=!1},3e3)}return I(()=>n.form.start_date,e=>{n.form.finish_date<e&&(n.form.finish_date=e)}),(e,t)=>{const se=Re,oe=Ce,re=Ne,_=Se,le=De,T=Te,ae=Pe,ne=Be,O=je,x=Ue,ie=lt,q=Ee,ue=Oe,R=Fe,de=Qe,ce=Ie,me=qe;return r(),u(L,null,[e.form.debug_mode?(r(),w(oe,{key:0,modelValue:e.results.logsModal,"onUpdate:modelValue":t[0]||(t[0]=a=>e.results.logsModal=a),title:"Logs"},{default:E(()=>[s(se,{logs:e.results.infoLogs},null,8,["logs"])]),buttons:E(()=>[c("button",{class:"ml-2 p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 focus:outline-none",onClick:te},[o(d)?(r(),w(o($e),{key:0,class:"h-6 w-6","aria-hidden":"true"})):i("",!0),!o(d)&&e.results.infoLogs.length!=0?(r(),w(o(Me),{key:1,class:"h-6 w-6","aria-hidden":"true"})):i("",!0)]),c("input",{id:"copy-info-logs",type:"hidden",value:e.results.infoLogs},null,8,at)]),_:1},8,["modelValue"])):i("",!0),e.results.executing&&!e.results.showResults?(r(),u("div",nt,[c("div",null,[s(re,{progress:e.results.progressbar.current},null,8,["progress"])]),e.results.exception.error?i("",!0):(r(),u("h3",{key:0,class:"mt-8 animate-pulse",textContent:M(o(ee))},null,8,it)),c("div",ut,[c("div",dt,[s(_,{color:"gray",ui:{color:{gray:{solid:"text-rose-500 dark:text-rose-400"}}},class:"w-64 flex justify-center",icon:"i-heroicons-no-symbol",size:"xl",variant:"solid",label:"Cancel",trailing:!1,onClick:t[1]||(t[1]=a=>o(C)((e._.provides[U]||e.$route).params.id))})]),c("div",ct,[e.form.debug_mode&&e.results.exception.error&&e.results.progressbar.current!==0?(r(),u("a",{key:0,href:o(D),class:"flex justify-center items-center btn-secondary text-center mb-4 w-full"},[s(_,{icon:"i-heroicons-document-arrow-down",label:"Debugging Logs",color:"gray",size:"xl",variant:"solid",trailing:!1,class:"w-64 flex justify-center"})],8,mt)):i("",!0)])]),e.results.exception.error&&e.results.executing?(r(),u("div",ft,[s(le,{modelValue:o(h),"onUpdate:modelValue":t[2]||(t[2]=a=>Ve(h)?h.value=a:null),title:e.results.exception.error,content:e.results.exception.traceback,mode:"backtest","debug-mode":e.form.debug_mode},null,8,["modelValue","title","content","debug-mode"])])):i("",!0)])):i("",!0),s(me,{else:""},{left:E(()=>[!e.results.executing&&!e.results.showResults?(r(),u("div",gt,[s(T,{class:"mb-4",title:"Exchange"}),s(ae,{modelValue:e.form.exchange,"onUpdate:modelValue":t[3]||(t[3]=a=>e.form.exchange=a),placeholder:"Select an exchange...",searchable:"",options:o(j)().backtestingExchangeNames,size:"lg",class:"mt-2 mb-16",onChange:y},null,8,["modelValue","options"]),s(ne,{"total-routes-error":o(m),timeframes:o(g),form:e.form,results:e.results,symbols:o(p),mode:"backtest"},null,8,["total-routes-error","timeframes","form","results","symbols"]),s(T,{class:"mt-16",title:"Duration"}),c("div",pt,[s(O,{modelValue:e.form.start_date,"onUpdate:modelValue":t[4]||(t[4]=a=>e.form.start_date=a),type:"date",variant:"outline",size:"lg",class:"w-full mr-2"},null,8,["modelValue"]),s(O,{modelValue:e.form.finish_date,"onUpdate:modelValue":t[5]||(t[5]=a=>e.form.finish_date=a),type:"date",variant:"outline",size:"lg",class:"w-full ml-2"},null,8,["modelValue"])]),s(T,{class:"mt-16",title:"Options"}),c("div",bt,[s(x,{modelValue:e.form.debug_mode,"onUpdate:modelValue":t[6]||(t[6]=a=>e.form.debug_mode=a),title:"Debug Mode",description:"Logs every step of the execution. Very helpful for debugging your strategy but takes a lot longer to execute"},null,8,["modelValue"]),s(x,{modelValue:e.form.export_chart,"onUpdate:modelValue":t[7]||(t[7]=a=>e.form.export_chart=a),title:"Export Charts",description:"Exports charts for your portfolio's daily balance."},null,8,["modelValue"]),s(x,{modelValue:e.form.export_tradingview,"onUpdate:modelValue":t[8]||(t[8]=a=>e.form.export_tradingview=a),title:"Export Tradingview",description:"Exports the executed trades in a format accepted by TradingView's Pine Editor. Useful to look at the executed orders on their chart."},null,8,["modelValue"]),s(x,{modelValue:e.form.export_full_reports,"onUpdate:modelValue":t[9]||(t[9]=a=>e.form.export_full_reports=a),title:"Export QuantStats reports",description:"Exports a HTML file generated by QuantStats library."},null,8,["modelValue"]),s(x,{modelValue:e.form.export_csv,"onUpdate:modelValue":t[10]||(t[10]=a=>e.form.export_csv=a),title:"Export CSV",description:"Exports executed trades in a CSV format"},null,8,["modelValue"]),s(x,{modelValue:e.form.export_json,"onUpdate:modelValue":t[11]||(t[11]=a=>e.form.export_json=a),title:"Export JSON",description:"Exports executed trades in a JSON format"},null,8,["modelValue"]),s(x,{modelValue:e.form.fast_mode,"onUpdate:modelValue":t[12]||(t[12]=a=>e.form.fast_mode=a),title:"Fast Mode",description:"Runs the backtest faster by using an improved algorithm. This is supposed to yield the same results; however, it's currently experimental, which is why it's an option."},null,8,["modelValue"]),s(x,{modelValue:e.form.benchmark,"onUpdate:modelValue":t[13]||(t[13]=a=>e.form.benchmark=a),title:"Benchmark",description:"If enabled, the backtest will compare the performance of the strategy against the buy and hold strategy of the market."},null,8,["modelValue"])])])):i("",!0),e.results.showResults?(r(),u("div",ht,[c("div",null,[o(k)?(r(),w(T,{key:0,class:"mb-4",title:"Equity Curve"})):i("",!0),o(k)?(r(),w(ie,{key:1,data:e.results.charts.equity_curve},null,8,["data"])):i("",!0),o(k)?(r(),w(T,{key:2,class:"mt-16 mb-4",title:"Performance"})):i("",!0),o(k)?(r(),w(q,{key:3,data:e.results.metrics},null,8,["data"])):i("",!0),o(k)?i("",!0):(r(),u("div",yt," No trades were executed via this strategy! "))])])):i("",!0)]),right:E(()=>[e.results.executing?i("",!0):(r(),u("div",vt,[e.results.showResults?(r(),u("div",_t,[s(_,{class:"w-full flex justify-center",icon:"i-heroicons-arrow-path",size:"xl",variant:"solid",label:"Rerun",trailing:!1,onClick:t[14]||(t[14]=a=>o(S)((e._.provides[U]||e.$route).params.id))}),s(_,{class:"w-full flex justify-center mt-4",color:"green",icon:"i-heroicons-arrow-uturn-left",size:"xl",variant:"solid",label:"New session",trailing:!1,onClick:t[15]||(t[15]=a=>o(H)((e._.provides[U]||e.$route).params.id))}),e.form.debug_mode?(r(),u("a",{key:0,href:o(D),target:"_blank",class:""},[s(_,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-document-arrow-down",size:"xl",variant:"solid",label:"Debugging Logs",trailing:!1})],8,kt)):i("",!0),e.form.export_chart&&o(k)?(r(),u("a",{key:1,href:o(A),target:"_blank",class:"flex justify-center items-center btn-secondary text-center w-full"},[s(_,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-document-arrow-down",size:"xl",variant:"solid",label:" Legacy Chart",trailing:!1})],8,wt)):i("",!0),e.form.export_full_reports&&o(k)?(r(),u("a",{key:2,href:o(X),target:"_blank",class:"flex justify-center items-center btn-secondary text-center w-full"},[s(_,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-document-arrow-down",size:"xl",variant:"solid",label:"QuantStats Report",trailing:!1})],8,xt)):i("",!0),e.form.export_csv&&o(k)?(r(),u("a",{key:3,href:o(Y),target:"_blank",class:"flex justify-center items-center btn-secondary text-center w-full"},[s(_,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-document-arrow-down",size:"xl",variant:"solid",label:"CVS",trailing:!1})],8,$t)):i("",!0),e.form.export_json&&o(k)?(r(),u("a",{key:4,href:o(Z),target:"_blank",class:"flex justify-center items-center btn-secondary text-center w-full"},[s(_,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-document-arrow-down",size:"xl",variant:"solid",label:"JSON",trailing:!1})],8,Vt)):i("",!0),e.form.export_tradingview&&o(k)?(r(),u("a",{key:5,href:o(G),target:"_blank",class:"flex justify-center items-center btn-secondary text-center mb-4 w-full"},[s(_,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-document-arrow-down",size:"xl",variant:"solid",label:"TradingView Pine Editor",trailing:!1})],8,Ct)):i("",!0),e.results.showResults&&e.results.alert&&e.results.alert.message?(r(),u("div",St,[s(ue,{color:"teal",icon:"i-heroicons-check-circle",variant:"soft",title:e.results.alert.message,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"white",variant:"link"},onClose:t[16]||(t[16]=a=>e.results.alert.message="")},null,8,["title"])])):i("",!0),s(R,{class:"mt-8 mb-4",size:"lg",label:"General Info"}),s(de,{data:e.results.info},null,8,["data"]),s(R,{class:"mt-8 mb-4",size:"lg",label:"Routes"}),s(ce,{data:e.results.routes_info,"header-items":["Symbol","Timeframe","Strategy"],header:""},null,8,["data"]),e.results.hyperparameters.length?(r(),w(R,{key:7,class:"mt-8 mb-4",size:"lg",label:"Hyperparameters"})):i("",!0),e.results.hyperparameters.length?(r(),w(q,{key:8,data:e.results.hyperparameters},null,8,["data"])):i("",!0)])):(r(),u("div",Tt,[s(_,{class:"w-full flex justify-center",icon:"i-heroicons-bolt",size:"xl",variant:"solid",label:"Start",trailing:!1,onClick:t[17]||(t[17]=a=>K((e._.provides[U]||e.$route).params.id))}),s(_,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-plus",size:"xl",variant:"solid",label:"Start in a new tab",trailing:!1,onClick:t[18]||(t[18]=a=>W((e._.provides[U]||e.$route).params.id))})]))]))]),_:1})],64)}}}),Ut={class:"w-full"},Ot=z({__name:"[id]",setup(V){He({title:"Backtest - Jesse"});const n=N(),m=v(()=>n.tabs),h=v(()=>Q().params.id),d=v(()=>{if(!m.value[h.value]){const f=Object.keys(m.value);if(f.length>0){const l=m.value[f[0]];return Le().push(`/backtest/${l.id}`),l}}return m.value[h.value]});return Object.keys(m.value).length===0&&n.addTab(),(f,l)=>{const b=et,g=jt;return r(),u(L,null,[c("div",Ut,[s(b,{"current-tab":d.value?d.value.id:null,tabs:m.value,mode:"backtest",onClose:o(n).closeTab},null,8,["current-tab","tabs","onClose"])]),d.value?(r(),w(g,{key:0,form:d.value.form,results:d.value.results},null,8,["form","results"])):i("",!0)],64)}}});export{Ot as default};
