import{c as e,gP as t,b as n,j as a,f0 as r,aS as i,r as o,gQ as s,as as c,gR as l,gS as u,gT as m,b9 as p,a7 as d,aY as f,T as h}from"./index-B2A5C0Fv.js";import{M as g,V as y}from"./VegaLite-DFHnIRA-.js";import{a as v}from"./url-BDPcoMBZ.js";import"./time-D1kr4-L0.js";import"./timer-Di1g2zcK.js";import"./linear-DJVnh6QX.js";import"./init-DLRA0X12.js";import"./range-CtcPcB_L.js";import"./zoom-COrs4lFh.js";import"./ordinal-DDUp3AbE.js";import"./arc-CyWW4RED.js";import"./path-qnb_ma6O.js";import"./step-CPXY0cSE.js";import"./array-DmjLdZ15.js";import"./line-BfNOlI_-.js";import"./index-Dr64gZD9.js";
/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k=e("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),j={getMarkType(e){const t="string"==typeof e?e:e.type;if("boxplot"===t||"errorband"===t||"errorbar"===t)throw new Error("Not supported");return t},makeClickable(e){const t="string"==typeof e?e:e.type;return t in g?"string"==typeof e?{type:e,cursor:"pointer",tooltip:!0}:{...e,type:t,cursor:"pointer",tooltip:!0}:e},getOpacity:e=>"string"==typeof e?null:"opacity"in e&&"number"==typeof e.opacity?e.opacity:null};const x=new Set(["color","fill","fillOpacity","opacity","shape","size"]);function w(e,t,n,a){const r={and:n.map((e=>({param:e})))};if("opacity"===e){const e=j.getOpacity(a)||1;return{...t,opacity:{condition:{test:r,value:e},value:e/5}}}return t}const b={point:e=>null==e?"select_point":`select_point_${e}`,interval:e=>null==e?"select_interval":`select_interval_${e}`,legendSelection:e=>`legend_selection_${e}`,HIGHLIGHT:"highlight",PAN_ZOOM:"pan_zoom",hasPoint:e=>e.some((e=>e.startsWith("select_point"))),hasInterval:e=>e.some((e=>e.startsWith("select_interval"))),hasLegend:e=>e.some((e=>e.startsWith("legend_selection"))),hasPanZoom:e=>e.some((e=>e.startsWith("pan_zoom")))},S={highlight:()=>({name:b.HIGHLIGHT,select:{type:"point",on:"mouseover"}}),interval:(e,t)=>({name:b.interval(t),select:{type:"interval",encodings:M(e),mark:{fill:"#669EFF",fillOpacity:.07,stroke:"#669EFF",strokeOpacity:.4},on:"[mousedown[!event.metaKey], mouseup] > mousemove[!event.metaKey]",translate:"[mousedown[!event.metaKey], mouseup] > mousemove[!event.metaKey]"}}),point:(e,t)=>({name:b.point(t),select:{type:"point",encodings:M(e),on:"click[!event.metaKey]"}}),legend:e=>({name:b.legendSelection(e),select:{type:"point",fields:[e]},bind:"legend"}),panZoom:()=>({name:b.PAN_ZOOM,bind:"scales",select:{type:"interval",on:"[mousedown[event.metaKey], window:mouseup] > window:mousemove!",translate:"[mousedown[event.metaKey], window:mouseup] > window:mousemove!",zoom:"wheel![event.metaKey]"}})};function M(e){switch(j.getMarkType(e.mark)){case g.image:case g.trail:return;case g.area:case g.arc:return["color"];case g.bar:{const t=function(e){var t,n;if(!e||!("mark"in e))return;const a=null==(t=e.encoding)?void 0:t.x,r=null==(n=e.encoding)?void 0:n.y;if(a&&"type"in a&&"nominal"===a.type)return"vertical";if(r&&"type"in r&&"nominal"===r.type)return"horizontal";if(a&&"aggregate"in a)return"horizontal";if(r&&"aggregate"in r)return"vertical";return}(e);return"horizontal"===t?["y"]:"vertical"===t?["x"]:void 0}case g.circle:case g.geoshape:case g.line:case g.point:case g.rect:case g.rule:case g.square:case g.text:case g.tick:return["x","y"]}}function _(e){if("params"in e&&e.params&&e.params.length>0){return e.params.filter((e=>null!=e&&("select"in e&&void 0!==e.select))).map((e=>e.name))}return"layer"in e?[...new Set(e.layer.flatMap(_))]:[]}function P(e,t){const{chartSelection:n=!0,fieldSelection:a=!0}=t;if(!n&&!a)return e;if("vconcat"in e){const t=e.vconcat.map((e=>"mark"in e?T(e):e));return{...e,vconcat:t}}if("hconcat"in e){const t=e.hconcat.map((e=>"mark"in e?T(e):e));return{...e,hconcat:t}}if("layer"in e){const t=e.layer.map(((e,t)=>{if(!("mark"in e))return e;let a=e;return a=O(a,n,t),a=T(a),0===t&&(a=N(a)),a}));return{...e,layer:t}}if(!("mark"in e))return e;let r=e;return r=function(e,t){if(!1===t)return e;let n=function(e){if(!e||!("encoding"in e))return[];const{encoding:t}=e;return t?Object.entries(t).flatMap((e=>{const[t,n]=e;return n&&x.has(t)?"field"in n&&"string"==typeof n.field?[n.field]:"condition"in n&&n.condition&&"object"==typeof n.condition&&"field"in n.condition&&n.condition.field&&"string"==typeof n.condition.field?[n.condition.field]:[]:[]})):[]}(e);Array.isArray(t)&&(n=n.filter((e=>t.includes(e))));const a=n.map((e=>S.legend(e))),r=[...e.params||[],...a];return{...e,params:r}}(r,a),r=O(r,n,void 0),r=T(r),r=N(r),r}function O(e,t,n){if(!1===t)return e;let a;try{a=j.getMarkType(e.mark)}catch{return e}if("geoshape"===a||"text"===a)return e;const r=!0===t?function(e){switch(e){case"text":case"arc":case"area":return["point"];case"bar":default:return["point","interval"];case"line":return}}(a):[t];if(!r)return e;const i=r.map((t=>"interval"===t?S.interval(e,n):S.point(e,n))),o=[...e.params||[],...i];return{...e,params:o}}function N(e){let t;try{t=j.getMarkType(e.mark)}catch{}if("geoshape"===t)return e;const n=e.params||[];return n.some((e=>"scales"===e.bind))?e:{...e,params:[...n,S.panZoom()]}}function T(e){const t="encoding"in e?e.encoding:void 0,n=e.params||[],a=n.map((e=>e.name));if(0===n.length)return e;return"text"===j.getMarkType(e.mark)?e:{...e,mark:j.makeClickable(e.mark),encoding:w("opacity",t||{},a,e.mark)}}const V=({value:e,setValue:i,chartSelection:o,fieldSelection:s,spec:c})=>{const{data:l,error:u}=n((async()=>async function(e){if(!e)return e;const n="datasets"in e?{...e.datasets}:{},a=async e=>{if(!e)return e;if("layer"in e){const t=await Promise.all(e.layer.map(a));e={...e,layer:t}}if("hconcat"in e){const t=await Promise.all(e.hconcat.map(a));e={...e,hconcat:t}}if("vconcat"in e){const t=await Promise.all(e.vconcat.map(a));e={...e,vconcat:t}}if(!e.data)return e;if(!("url"in e.data))return e;let r;try{r=v(e.data.url)}catch{return e}const i=await t(r.href,e.data.format);return n[r.pathname]=i,{...e,data:{name:r.pathname}}},r=await a(e);return 0===Object.keys(n).length?r:{...r,datasets:n}}(c)),[c]);return u?a.jsx(r,{error:u}):l?a.jsx(z,{value:e,setValue:i,chartSelection:o,fieldSelection:s,spec:l}):null},z=({value:e,setValue:t,chartSelection:n,fieldSelection:r,spec:g})=>{const{theme:j}=i(),x=o.useRef(),[w,S]=o.useState(),M=o.useMemo((()=>P(function(e){return e.data&&"url"in e.data&&(e.data.url=v(e.data.url).href),e}(g),{chartSelection:n,fieldSelection:r})),[s(g),n,r]),O=o.useMemo((()=>_(M)),[M]),N=c((n=>{t({...e,...n})})),T=o.useMemo((()=>O.reduce(((e,t)=>(b.PAN_ZOOM===t||(e[t]=l(((e,t)=>{d.debug("[Vega signal]",e,t),N({[e]:f.mapValues(t,Z)})}),100)),e)),{})),[s(O),t]),V=c((e=>{d.error(e),d.debug(M),S(e)})),z=c((e=>{d.debug("[Vega view] created",e),x.current=e,S(void 0)}));return a.jsxs(a.Fragment,{children:[w&&a.jsxs(u,{variant:"destructive",children:[a.jsx(m,{children:w.message}),a.jsx("div",{className:"text-md",children:w.stack})]}),a.jsxs("div",{className:"relative",onPointerDown:p.stopPropagation(),children:[a.jsx(y,{spec:M,theme:"dark"===j?"dark":void 0,actions:K,signalListeners:T,onError:V,onNewView:z}),(()=>{const e=[];return b.hasPoint(O)&&e.push(["Point selection","click to select a point; hold shift for multi-select"]),b.hasInterval(O)&&e.push(["Interval selection","click and drag to select an interval"]),b.hasLegend(O)&&e.push(["Legend selection","click to select a legend item; hold shift for multi-select"]),b.hasPanZoom(O)&&e.push(["Pan","hold the meta key and drag"],["Zoom","hold the meta key and scroll"]),0===e.length?null:a.jsx(h,{delayDuration:300,side:"left",content:a.jsx("div",{className:"text-xs flex flex-col",children:e.map(((e,t)=>a.jsxs("div",{children:[a.jsxs("span",{className:"font-bold tracking-wide",children:[e[0],":"]})," ",e[1]]},t)))}),children:a.jsx(k,{className:"absolute bottom-1 right-0 m-2 h-4 w-4 cursor-help text-muted-foreground hover:text-foreground"})})})()]})]})},K={source:!1,compiled:!1};function Z(e){return e instanceof Set?[...e]:e}export{V as default};
