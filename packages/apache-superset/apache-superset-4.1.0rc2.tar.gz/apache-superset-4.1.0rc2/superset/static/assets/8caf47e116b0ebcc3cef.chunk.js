"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[8551],{88551:(e,t,r)=>{r.r(t),r.d(t,{default:()=>y});var n=r(67294),l=r(55786),a=r(16355),o=r(5364),s=r(51115),u=r(67190),c=r(10581),i=r(63475),d=r(6915),f=r(51995),h=r(93362),g=r(49239),p=r(35944);const{RadioButtonControl:m}=h.default,v=f.iK.div`
  text-align: center;
`;function b({formData:e,setControlValue:t}){const{extraControlsOptions:r,extraControlsHandler:l,extraValue:a}=function({formData:e,setControlValue:t}){const{stack:r,area:l}=e,[a,o]=(0,n.useState)(null!=r?r:void 0);return(0,n.useEffect)((()=>{o(r)}),[r]),{extraControlsOptions:(0,n.useMemo)((()=>l?g.Df:[]),[l]),extraControlsHandler:(0,n.useCallback)((e=>{l&&t&&(t("stack",e),o(e))}),[l,t]),extraValue:a}}({formData:e,setControlValue:t});return e.showExtraControls?(0,p.tZ)(v,{children:(0,p.tZ)(m,{options:r,onChange:l,value:a})}):null}const C=300;function y({formData:e,height:t,width:r,echartOptions:f,groupby:h,labelMap:g,selectedValues:m,setDataMask:v,setControlValue:y,legendData:x=[],onContextMenu:k,onLegendStateChanged:w,onFocusedSeries:E,xValueFormatter:V,xAxis:Z,refs:S,emitCrossFilters:D,coltypeMapping:F}){const{stack:O}=e,R=(0,n.useRef)(null);S.echartRef=R;const H=(0,n.useRef)(),M=(0,n.useRef)(null),[I,T]=(0,n.useState)(0);(0,n.useEffect)((()=>{var e;const t=(null==(e=M.current)?void 0:e.offsetHeight)||0;T(t)}),[e.showExtraControls]);const N=(0,n.useCallback)((e=>{const t=Object.values(m);let r;r=t.includes(e)?t.filter((t=>t!==e)):[e];const n=r.map((e=>g[e]));return{dataMask:{extraFormData:{filters:0===r.length?[]:h.map(((e,t)=>{const r=n.map((e=>e[t]));return null==r?{col:e,op:"IS NULL"}:{col:e,op:"IN",val:r}}))},filterState:{label:n.length?n:void 0,value:n.length?n:null,selectedValues:r.length?r:null}},isCurrentValueSelected:t.includes(e)}}),[h,g,m]),j=(0,n.useCallback)((e=>{D&&v(N(e).dataMask)}),[D,v,N]),B={click:e=>{H.current&&clearTimeout(H.current),H.current=setTimeout((()=>{const{seriesName:t}=e;j(t)}),C)},mouseout:()=>{E(null)},mouseover:e=>{E(e.seriesName)},legendselectchanged:e=>{null==w||w(e.selected)},legendselectall:e=>{null==w||w(e.selected)},legendinverseselect:e=>{null==w||w(e.selected)},contextmenu:async t=>{if(k){var r;t.event.stop();const{data:n,seriesName:i}=t,f=[],h=[],p=t.event.event,m=[...t.name?[t.name]:[],...null!=(r=g[i])?r:[]],v=(0,l.Z)(e.groupby);n&&Z.type===a.we.Time&&f.push({col:Z.label===o.W3?e.granularitySqla:Z.label,grain:e.timeGrainSqla,op:"==",val:n[0],formattedVal:V(n[0])}),[...Z.type===a.we.Category&&n?[Z.label]:[],...v].forEach(((e,t)=>f.push({col:e,op:"==",val:m[t],formattedVal:String(m[t])}))),v.forEach(((t,r)=>{const n=g[i][r];h.push({col:t,op:"==",val:n,formattedVal:(0,d.mj)(m[r],{timeFormatter:(0,s.bt)(e.dateFormat),numberFormatter:(0,u.JB)(e.numberFormat),coltype:null==F?void 0:F[(0,c.Z)(t)]})})})),k(p.clientX,p.clientY,{drillToDetail:f,crossFilter:N(i),drillBy:{filters:h,groupbyFieldName:"groupby"}})}}},L={dblclick:e=>{var t;H.current&&clearTimeout(H.current);const r=[e.offsetX,e.offsetY],n=null==(t=R.current)?void 0:t.getEchartInstance();if(null!=n&&n.containPixel("grid",r)){var l;if(!O&&"ec-polygon"===(null==(l=e.target)?void 0:l.type))return;const t=n.getModel(),r=((e,t)=>{let r=e,n=null;for(;r;){const e=r.__ecComponentInfo;if(null!=e){n=t.getComponent(e.mainType,e.index);break}r=r.parent}return n})(e.target,t);if(r){const{name:e}=r,t=x.reduce(((t,r)=>({...t,[r]:r===e})),{});null==w||w(t)}}}};return(0,p.BX)(p.HY,{children:[(0,p.tZ)("div",{ref:M,children:(0,p.tZ)(b,{formData:e,setControlValue:y})}),(0,p.tZ)(i.Z,{ref:R,refs:S,height:t-I,width:r,echartOptions:f,eventHandlers:B,zrEventHandlers:L,selectedValues:m})]})}},63475:(e,t,r)=>{r.d(t,{Z:()=>c});var n=r(67294),l=r(51995),a=r(31431),o=r(35944);const s=l.iK.div`
  height: ${({height:e})=>e};
  width: ${({width:e})=>e};
`;function u({width:e,height:t,echartOptions:r,eventHandlers:l,zrEventHandlers:u,selectedValues:c={},refs:i},d){const f=(0,n.useRef)(null);i&&(i.divRef=f);const h=(0,n.useRef)(),g=(0,n.useMemo)((()=>Object.keys(c)||[]),[c]),p=(0,n.useRef)([]);(0,n.useImperativeHandle)(d,(()=>({getEchartInstance:()=>h.current}))),(0,n.useEffect)((()=>{f.current&&(h.current||(h.current=(0,a.S1)(f.current)),Object.entries(l||{}).forEach((([e,t])=>{var r,n;null==(r=h.current)||r.off(e),null==(n=h.current)||n.on(e,t)})),Object.entries(u||{}).forEach((([e,t])=>{var r,n;null==(r=h.current)||r.getZr().off(e),null==(n=h.current)||n.getZr().on(e,t)})),h.current.setOption(r,!0))}),[r,l,u]),(0,n.useEffect)((()=>{h.current&&(h.current.dispatchAction({type:"downplay",dataIndex:p.current.filter((e=>!g.includes(e)))}),g.length&&h.current.dispatchAction({type:"highlight",dataIndex:g}),p.current=g)}),[g]);const m=(0,n.useCallback)((({width:e,height:t})=>{h.current&&h.current.resize({width:e,height:t})}),[]);return(0,n.useEffect)((()=>(m({width:e,height:t}),()=>{var e;return null==(e=h.current)?void 0:e.dispose()})),[]),(0,n.useLayoutEffect)((()=>{m({width:e,height:t})}),[e,t,m]),(0,o.tZ)(s,{ref:f,height:t,width:e})}const c=(0,n.forwardRef)(u)}}]);
//# sourceMappingURL=8caf47e116b0ebcc3cef.chunk.js.map