% Tables in tikz, but first we need to define some colors for nonwhite text backgrounds
\definecolor{OBSHDRFill}{HTML}{0a6c97}
\definecolor{SIMHDRFill}{HTML}{646464}
\definecolor{DataFill}{HTML}{dfeadf}
% The below are definition's from Paul Tol's website, https://personal.sron.nl/~pault/
\definecolor{VibrBlue}{HTML}{0077bb}
\definecolor{BrightGreen}{HTML}{228833}
\definecolor{HiCoYellow}{HTML}{ddaa33}
\definecolor{VibrRed}{HTML}{cc3311}

%% Rotating text in a tabularray cell
%% https://tex.stackexchange.com/questions/101686/rotating-text-in-a-cell
%%https://tex.stackexchange.com/questions/464170/how-to-rotate-text-in-table
\usepackage{rotating}
\usepackage{makecell}

%% https://github.com/lvjr/tabularray/discussions/85#discussioncomment-3397197
\setlength\rotheadsize{1.5cm}
\renewcommand\theadfont{}



\newcount\tnr
\newcount\tnc
% \makeatletter
% \tikzset{record matrix dimensions/.style={execute at end matrix={
%                     \global\tnc=\pgf@matrix@numberofcolumns
%                     \global\tnr=\pgfmatrixcurrentrow
%                 }}}
% \makeatother

% Some useful documents from grokking various options used below
% https://courses.helsinki.fi/sites/default/files/course-material/4611024/LaTeXandFriendsCourseInHelsinki_9_v2.pdf
% https://tug.org/TUGboat/tb39-1/tb121duck-tikz.pdf
% https://tug.org/TUGboat/tb41-1/tb127duck-matrix.pdf
% https://tex.stackexchange.com/questions/22286/coloring-every-other-row-of-a-table-with-vertical-lines
% https://tex.stackexchange.com/questions/354043/swot-matrix-with-multicolumn-and-multirow
% https://tex.stackexchange.com/questions/20599/horizontal-row-separation-line-in-tikz-matrix-like-hline-in-tabular
% https://tex.stackexchange.com/questions/63560/how-to-use-x-coordinate-of-a-point-and-y-coordinate-of-other-point
% https://tex.stackexchange.com/questions/167944/auto-word-wrapping-in-a-node-in-tikz
% https://tex.stackexchange.com/questions/132741/typewriter-in-tikz-node
\tikzset{
    green_bar_filler/.code={
            \pgfmathtruncatemacro{\itest}{ifthenelse(%
                \pgfmatrixcurrentcolumn==1,0,%
                ifthenelse(iseven(\pgfmatrixcurrentrow),1,3))}
            %\typeout{\the\pgfmatrixcurrentcolumn,\pgfmatrixcurrentrow->\itest}
            \ifcase\itest
                \tikzset{fill=none}%
            \or
                \tikzset{fill=DataFill}%
            \else
                \tikzset{fill=white}%
            \fi
        },
    get_matrix_dims/.code={
            \global\tnc=\pgf@matrix@numberofcolumns
            \global\tnr=\pgfmatrixcurrentrow
        },
    record matrix dimensions/.style={
            execute at end matrix={get_matrix_dims},
            % execute at end matrix={
            %         \global\tnc=\pgf@matrix@numberofcolumns
            %         \global\tnr=\pgfmatrixcurrentrow
            %     }
        },
    % If you only have numbers, text depth = 0ex; if text, text depth = 0.25ex, (may need tweaking for alignment across cells)
    anytext/.style = {
            font = \sffamily\scriptsize\addfontfeatures{Numbers={Monospaced,Lining}},
            align = center,
            inner sep = 3pt,
            text depth = 0pt,
        },
    hdrtext/.style = {
            anytext,
            text = white,
            fill = OBSHDRFill,
        },
    notetext/.style = {
            anytext,
            font = \sffamily\tiny,
            align = left,
        },
    anytable/.style = {
            matrix of nodes,
            nodes in empty cells,
            column sep = -1.0\pgflinewidth,
            row sep = -1.0\pgflinewidth,
            inner sep = -0.25\pgflinewidth,
            outer sep = -0.25\pgflinewidth,
            nodes = {anchor = center, minimum height = 12.5pt,}
        },
    datatable/.style = {
            anytable,
            nodes = {
                    anytext,
                    align = right,
                    draw = none,
                    fill = none,
                    green_bar_filler,
                },
            % execute at end matrix={
            %         \global\tnc=\pgf@matrix@numberofcolumns
            %         \global\tnr=\pgfmatrixcurrentrow
            %     },
        },
    hdrtable/.style = {
            anytable,
            nodes = {
                    hdrtext,
                    draw = none,
                    fill = OBSHDRFill,
                },
        },
    hrow/.style = {
            hdrtable,
            nodes = {text width = 40pt,},
        },
    hcol/.style = {
            hdrtable,
            nodes = {text width = 60pt,},
        },
}
% Define layers for later reference
% https://tex.stackexchange.com/questions/40840/put-a-node-behind-another-in-a-tikz-diagram
\pgfdeclarelayer{background}
\pgfsetlayers{background,main}


