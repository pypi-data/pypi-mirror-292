"use strict";(self.webpackChunkjupyter_cassini=self.webpackChunkjupyter_cassini||[]).push([[541],{255:(e,t,n)=>{n.d(t,{KG:()=>N});var i,o=n(901),s=n(586),a=n(281),r=n(663);async function l(e="",t={},n={}){const i=r.ServerConnection.makeSettings(),o=a.URLExt.join(i.baseUrl,"jupyter_cassini",e)+a.URLExt.objectToQueryString(n);let s;try{s=await r.ServerConnection.makeRequest(o,t,i)}catch(e){throw new r.ServerConnection.NetworkError(e)}let l=await s.text();if(l.length>0)try{l=JSON.parse(l)}catch(e){console.log("Not a JSON response body.",s)}if(!s.ok)throw new r.ServerConnection.ResponseError(s,l.message||l);return l}!function(e){e.lookup=function(e){return l("lookup",{},{id:e})},e.tree=function(e){return l("tree",{},{identifiers:e})},e.newChild=function(e){return l("newChild",{body:JSON.stringify(e),method:"POST"})},e.openTier=function(e){return l("open",{},{id:e})}}(i||(i={}));var d=n(567),c=n(768);const h=["description","conclusion","started"];class u{constructor(e){if(this._changed=new o.Signal(this),this.name=e.name,this.identifiers=e.identifiers,this.notebookPath=e.notebookPath,this.hltsPath=e.hltsPath,N.treeManager.changed.connect(((e,{ids:t,data:n})=>{t.toString()===this.identifiers.toString()&&this._changed.emit()})),this._required=[],e.metaPath){const t=this.metaFile=new c.Context({manager:N.contentService,factory:new c.TextModelFactory,path:e.metaPath});this._required.push(t.ready),t.initialize(!1),t.ready.then((()=>{t.model.contentChanged.connect((()=>this._changed.emit()),this),t.model.stateChanged.connect(((e,t)=>{"dirty"===t.name&&this._changed.emit()}))}))}e.hltsPath&&N.contentService.contents.get(e.hltsPath,{content:!1}).then((t=>{const n=this.hltsFile=new c.Context({manager:N.contentService,factory:new c.TextModelFactory,path:e.hltsPath});this._required.push(n.ready),n.initialize(!1),this.hltsFile.ready.then((()=>{var e;null===(e=this.hltsFile)||void 0===e||e.model.contentChanged.connect((()=>{this._changed.emit()}),this)}))})).catch((e=>e))}get changed(){return this._changed}get ready(){return Promise.all(this._required).then((()=>this))}get treeData(){return N.treeManager.get(this.identifiers)}get children(){return this.treeData.then((e=>(null==e?void 0:e.children)||null))}get meta(){var e;return(null===(e=this.metaFile)||void 0===e?void 0:e.isReady)?this.metaFile.model.toJSON():{}}get additionalMeta(){const e={},t=this.meta;for(const n in t)h.indexOf(n)<0&&(e[n]=t[n]);return e}get description(){return this.meta.description||""}set description(e){if(!this.metaFile)throw"Tier has no meta, cannot store description";const t=this.meta;t.description=e,this.metaFile.model.fromJSON(t)}get conclusion(){return this.meta.conclusion||""}set conclusion(e){if(!this.metaFile)throw"Tier has no meta, cannot store conclusion";const t=this.meta;t.conclusion=e,this.metaFile.model.fromJSON(t)}get dirty(){var e;return(null===(e=this.metaFile)||void 0===e?void 0:e.model.dirty)||!1}get hltsOutputs(){if(void 0===this.hltsFile)return[];const e=[],t=this.hltsFile.model.toJSON();for(const n in t){const i=t[n];for(const t in i){const n=i[t];e.push({output_type:"display_data",...n})}}return e}save(){var e,t;return Promise.all([null===(e=this.metaFile)||void 0===e?void 0:e.save(),null===(t=this.hltsFile)||void 0===t?void 0:t.save()]).then()}revert(){var e;let t;return t=this.hltsPath&&!this.hltsFile?N.contentService.contents.get(this.hltsPath,{content:!1}).then((e=>{(this.hltsFile=new c.Context({manager:N.contentService,factory:new c.TextModelFactory,path:this.hltsPath})).initialize(!1)})).catch((e=>e)):Promise.resolve(),Promise.all([null===(e=this.metaFile)||void 0===e?void 0:e.revert(),t.then((()=>{var e;return null===(e=this.hltsFile)||void 0===e?void 0:e.ready.then((()=>{var e;return null===(e=this.hltsFile)||void 0===e?void 0:e.revert()}))}))]).then()}}class m{constructor(){this._childrenUpdated=new o.Signal(this),this.currentPath=new d.ObservableList,this.treeManager=N.treeManager,this.currentPath.changed.connect((()=>{this._childrenUpdated.emit(this.current)}),this),N.treeManager.changed.connect(((e,{ids:t,data:n})=>{t.toString()===this.sCurrentPath.toString()&&this._childrenUpdated.emit(this.current)})),this._additionalColumnsStore={additionalColumns:new Set,children:{}}}get childrenUpdated(){return this._childrenUpdated}get additionalColumns(){let e=this._additionalColumnsStore;for(const t of this.currentPath){let n=e.children[t];n||(n=e.children[t]={additionalColumns:new Set,children:{}}),e=n}return e.additionalColumns}getChildren(){return this.current.then((e=>(null==e?void 0:e.children)?e.children:{}))}get current(){return this.treeManager.get(this.sCurrentPath)}get sCurrentPath(){return Array.from(this.currentPath)}refresh(){return this.treeManager.fetchTierData(this.sCurrentPath)}}var p=n(882),g=n(29),C=n.n(g),w=n(120),v=n(316),f=n(386);const b=new v.LabIcon({name:"cassini:home",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"><g class="jp-icon3" fill="#616161"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></g></svg>'});var E=n(71);class y extends C().Component{constructor(e){super(e),this.state={children:{},childMetas:[],additionalColumns:e.model.additionalColumns},console.log(this.state);const t=this.setState.bind(this);this.props.model.childrenUpdated.connect((n=>{this.props.model.getChildren().then((e=>t({children:e}))),this.props.model.current.then((n=>{var i;t({childMetas:n&&(null===(i=n.childClsInfo)||void 0===i?void 0:i.metaNames)||[]}),t({additionalColumns:e.model.additionalColumns})}))}))}openContextMenu(e){const t=new Set([...this.state.additionalColumns,...this.state.childMetas]);if(!t.size)return;e&&(e.preventDefault(),e.stopPropagation());const n=new w.CommandRegistry;for(const e of t){const t=this.state.additionalColumns.has(e)?v.checkIcon:void 0;n.addCommand(e,{label:e,icon:t,execute:t=>this.setState(((t,n)=>{const i=t.additionalColumns;return i.has(e)?(i.delete(e),this.props.model.additionalColumns.delete(e),{additionalColumns:i}):(this.props.model.additionalColumns.add(e),{additionalColumns:t.additionalColumns.add(e)})}))})}const i=new p.Menu({commands:n});i.addItem({command:"Add Meta",type:"separator"});for(const e of t)i.addItem({command:e});e&&i.open(e.clientX,e.clientY)}render(){const e=this.props.onTierSelected,t=this.props.onTierLaunched,n=this.props.onCreateChild,i=this.openContextMenu.bind(this),o=this.state.additionalColumns;return C().createElement("div",{"data-jp-suppress-context-menu":!0},C().createElement(x,{children:this.state.children,model:this.props.model,onTierLaunched:t,onTierSelected:e,onCreateChild:n,onSelectMetas:i,additionalColumns:o}))}}const T=e=>{const[t,n]=(0,g.useState)(""),o=e.model;return C().createElement(v.InputGroup,{type:"text",rightIcon:"ui-components:search",placeholder:"Search by name",onChange:e=>{n(e.target.value)},onKeyDown:e=>{"Enter"===e.key&&i.lookup(t).then((e=>{o.currentPath.clear(),o.currentPath.pushAll(e.identifiers)}))}})};class M extends C().Component{constructor(e){super(e),this.state={currentTier:null};const t=this.setState.bind(this);this.props.model.currentPath.changed.connect((()=>this.props.model.current.then((e=>{e&&t({currentTier:e})}))))}render(){const e=[],t=this.props.model.currentPath,n=this.state.currentTier,i=this.props.model.refresh.bind(this.props.model),o=this.props.onTierLaunched,s=this.props.onTierSelected,a=this.props.onCreateChild;for(let n=0;n<t.length-1;n++)e.push(C().createElement("span",null,C().createElement("span",{className:"jp-BreadCrumbs-item",onClick:()=>{t.removeRange(n+1,t.length)}},t.get(n)),C().createElement("span",null,"/")));return C().createElement("div",{className:"cas-CassiniCrumbs-box"},C().createElement("div",{className:"jp-BreadCrumbs jp-FileBrowser-crumbs cas-CassiniCrumbs-row"},C().createElement("span",{className:"jp-BreadCrumbs-home"},C().createElement(v.ToolbarButtonComponent,{icon:b,onClick:()=>t.clear(),tooltip:"Go Home"})),C().createElement("span",null,"/"),e,C().createElement("div",{className:"cas-icon-area"},C().createElement("span",{onClick:()=>i()},C().createElement(v.ToolbarButtonComponent,{icon:v.refreshIcon,onClick:()=>i(),tooltip:"Refresh tree (will fetch changes from server)"})))),C().createElement("div",{className:"jp-BreadCrumbs jp-FileBrowser-crumbs cas-CassiniCrumbs-row"},C().createElement("span",{className:"cas-tier-name"},null==n?void 0:n.name),C().createElement("span",null,"/"),C().createElement("span",null,C().createElement(v.ToolbarButtonComponent,{icon:v.addIcon,className:"jp-BreadCrumbs-home jp-ToolbarButtonComponent-icon",onClick:()=>{n&&a(n)},tooltip:`Add new child of ${null==n?void 0:n.name}`})),C().createElement("div",{className:"cas-icon-area"},C().createElement(v.ToolbarButtonComponent,{icon:v.launcherIcon,className:"jp-BreadCrumbs-home jp-ToolbarButtonComponent-icon",onClick:()=>{n&&o(n)},tooltip:`Open ${null==n?void 0:n.name}`}),C().createElement("span",null,C().createElement(v.ToolbarButtonComponent,{icon:v.caretRightIcon,className:"jp-BreadCrumbs-home jp-ToolbarButtonComponent-icon",onClick:()=>{n&&s([...t],n)},tooltip:`Preview ${null==n?void 0:n.name}`})))))}}function x(e){const t=e.model,n=e.onTierLaunched,i=e.onTierSelected,o=e.onCreateChild,s=t.currentPath,[a,r]=(0,g.useState)(null);t.currentPath.changed.connect((()=>t.current.then((e=>{e&&r(e)}))));const[l,d]=C().useState([]),c=(0,g.useMemo)((()=>Object.entries(e.children)),[e.children,e.additionalColumns]),h=(0,f.createColumnHelper)(),u=(()=>{let t=[h.accessor(((e,t)=>e[1].name),{id:"name",header:"Name",size:45,cell:e=>{let t;try{t=c[e.row.index][0]}catch(e){t=null}return C().createElement("span",{className:"cas-tier-name jp-BreadCrumbs-item",onClick:()=>t?s.push(t):null},C().createElement("span",null,e.getValue()))}}),h.accessor(((e,t)=>e[1].started||null),{id:"started",header:"Started",size:50,cell:e=>{const t=e.getValue();return t&&C().createElement("span",null,C().createElement("span",null,t.toLocaleDateString()))}}),h.accessor(((e,t)=>e[1].info||""),{id:"info",header:"Info",cell:e=>{const t=e.getValue();return C().createElement("span",null,C().createElement("span",null,t))}}),h.accessor(((e,t)=>e[1].outcome||""),{id:"outcome",header:"Outcome",cell:e=>{const t=e.getValue();return C().createElement("span",null,C().createElement("span",null,t))}})];for(const n of e.additionalColumns)t.push(h.accessor(((e,t)=>{var i;const o=null===(i=e[1])||void 0===i?void 0:i.additionalMeta;if(o)return o[n]}),{id:n,header:n,cell:e=>C().createElement("span",null,C().createElement("span",null,e.getValue()))}));return t=t.concat([h.display({id:"addColumn",header:()=>C().createElement("span",{onClick:t=>e.onSelectMetas(t)},C().createElement(v.ToolbarButtonComponent,{icon:v.editIcon,tooltip:"Edit columns"})),enableResizing:!1,size:20}),h.display({id:"actions",header:"",enableResizing:!1,size:40,cell:e=>{let t;try{t=c[e.row.index][1]}catch(e){t=null}const o=c[e.row.index][1],a=c[e.row.index][0],r={...o,identifiers:[...s,a]};return C().createElement("div",{className:"cas-row-icon-area"},C().createElement("span",null,C().createElement(v.ToolbarButtonComponent,{icon:v.caretRightIcon,onClick:()=>{t&&i([...s,a],r)},tooltip:`Preview ${r.name}`})),C().createElement("span",null,C().createElement(v.ToolbarButtonComponent,{icon:v.launcherIcon,onClick:()=>{c&&n(r)},tooltip:`Open ${r.name}`})))}})]),t})(),m=(0,f.useReactTable)({data:c,columns:u,state:{sorting:l},onSortingChange:d,getCoreRowModel:(0,f.getCoreRowModel)(),getSortedRowModel:(0,f.getSortedRowModel)(),columnResizeMode:"onChange"});return C().createElement("div",null,C().createElement("h1",null,null==a?void 0:a.name),C().createElement("table",{className:"cas-ChildrenTable-table"},C().createElement("thead",{onContextMenu:t=>e.onSelectMetas(t)},C().createElement("tr",null,m.getFlatHeaders().map((e=>{var t;return C().createElement("th",{key:e.id,className:["addColumns","launch","select"].includes(e.id)?"":"jp-DirListing-headerItem jp-id-name",style:{width:e.getSize()/m.getCenterTotalSize()*100+"%"}},C().createElement("span",{className:e.column.getCanSort()?"cursor-pointer select-none":"",onClick:e.column.getToggleSortingHandler()},(0,f.flexRender)(e.column.columnDef.header,e.getContext()),null!==(t={asc:C().createElement(v.caretUpIcon.react,{tag:"span"}),desc:C().createElement(v.caretDownIcon.react,{tag:"span"})}[e.column.getIsSorted()])&&void 0!==t?t:null),e.column.getCanResize()?C().createElement("div",{onMouseDown:e.getResizeHandler(),onTouchStart:e.getResizeHandler(),className:"cas-table-resizer"}):null)})))),C().createElement("tbody",null,m.getRowModel().rows.map((e=>C().createElement("tr",{className:"cas-ChildrenTable-row"},e.getVisibleCells().map((e=>C().createElement("td",{key:e.id},(0,f.flexRender)(e.column.columnDef.cell,e.getContext())))))))),C().createElement("tfoot",null,C().createElement("span",null,C().createElement("tr",null,C().createElement("td",{colSpan:3},C().createElement(v.ToolbarButtonComponent,{icon:v.addIcon,onClick:()=>a&&o(a),tooltip:`Create new child of ${null==a?void 0:a.name}`})))))))}class S extends s.ReactWidget{constructor(e){super(),this._tierSelected=new o.Signal(this),this._tierLaunched=new o.Signal(this),this.model=e,this.addClass("cas-TierBrowser")}get tierSelected(){return this._tierSelected}get tierLaunched(){return this._tierLaunched}render(){const e=(e,t)=>{this._tierSelected.emit({path:e,tier:t})},t=e=>{this._tierLaunched.emit(e)},n=e=>(0,E.D$)(e).then((()=>this.model.refresh()));return C().createElement("div",{style:{height:"100%",overflow:"auto"}},C().createElement(T,{model:this.model}),C().createElement(M,{model:this.model,onTierSelected:e,onTierLaunched:t,onCreateChild:n}),C().createElement(y,{model:this.model,onTierSelected:e,onTierLaunched:t,onCreateChild:n}))}}var k=n(770);class P extends p.SplitPanel{constructor(e){super();const t=e||[];this.id=`cas-container-${t}`;const n=this.model=new m;console.log(this),N.treeManager.get(t).then((e=>{var i;if(!e)return;const o=this.browser=new S(n);o.tierSelected.connect(((e,t)=>{this.openTier(t.path,t.tier)}),this),o.tierLaunched.connect(((e,t)=>{this.launchTier(t)}),this),this.addWidget(o),p.SplitPanel.setStretch(o,0);const s=this.viewer=new k.R7(e);this.addWidget(s),p.SplitPanel.setStretch(s,1),this.setRelativeSizes([3,1]),null===(i=o.renderPromise)||void 0===i||i.then((e=>{n.currentPath.clear(),n.currentPath.pushAll(t)}))}))}openTier(e,t){this.viewer.setHidden(!0),this.viewer.dispose();const n=this.viewer=new k.R7(t);n.model.metaFile&&n.model.metaFile.ready.then((e=>{this.viewer.update()})),n.model.hltsFile&&n.model.hltsFile.ready.then((e=>{this.viewer.update()})),this.addWidget(n),p.SplitPanel.setStretch(n,1)}launchTier(e){N.launchTier(e)}}class R{constructor(){this._changed=new o.Signal(this),this.cache={},this.nameCache={}}get changed(){return this._changed}initialize(){return this.fetchTierData([]).then((e=>e))}get(e,t=!1){if(t)return this.fetchTierData(e);let n=this.cache;for(const t of e){const i=null==n?void 0:n.children;if(void 0===i)return this.fetchTierData(e);if(n=i[t],void 0===n)return this.fetchTierData(e)}return void 0===(null==n?void 0:n.children)?this.fetchTierData(e):new Promise((e=>e(n)))}async lookup(e){if(Object.keys(this.nameCache).includes(e))return Promise.resolve(this.nameCache[e]);const t=await i.lookup(e);return this.get(t.identifiers)}cacheTreeData(e,t){let n=this.cache;for(const t of e){if(!n)break;let e=n.children;void 0===e&&(e=n.children={}),void 0===e[t]&&(e[t]={}),n=e[t]}return Object.assign(n,t),this.nameCache[t.name]=n,this._changed.emit({ids:e,data:t}),n}fetchTierData(e){return i.tree(e).then((t=>{const n=R._treeResponseToData(t,e);return this.cacheTreeData(e,n)})).catch((e=>null))}static _treeResponseToData(e,t){const{started:n,children:i,...o}=e,s={started:null,children:{},identifiers:t,...o};n&&(s.started=new Date(n));for(const e of Object.keys(i)){const t=i[e],{started:n,...o}=t,a={started:null,...o};t.started&&(a.started=new Date(t.started)),s.children[e]=a}return s}}class B{constructor(){this.cache={}}get(e,t){return Object.keys(this.cache).includes(e)&&!t?t=>this.cache[e]:t=>this._insertNewTierModel(e,t)}_insertNewTierModel(e,t){const n=new u(t);return this.cache[e]=n,n}}const N=new class{constructor(){this.treeManager=new R,this.tierModelManager=new B,this.ready=new Promise(((e,t)=>{this.resolveReady=e}))}async initialize(e,t,n,i,o){return this.app=e,this.contentService=t,this.contentFactory=n,this.rendermimeRegistry=i,this.commandRegistry=o,this.treeManager.initialize().then((()=>this.resolveReady())),this.ready}async launchTierBrowser(e){await this.ready;const t=`cassini-browser-${e}`;if(e&&Array.from(this.app.shell.widgets()).map((e=>e.id)).includes(t))return void this.app.shell.activateById(t);const n=new P(e),i=new s.MainAreaWidget({content:n});i.id=t,i.title.label="Cassini Browser",i.title.closable=!0,i.isAttached||this.app.shell.add(i,"main"),this.app.shell.activateById(i.id)}get launchTierBrowserCommand(){return async e=>this.launchTierBrowser.bind(this)()}launchTier(e){e.notebookPath?this.app.commands.execute("docmanager:open",{path:e.notebookPath}):i.openTier(e.name).then((e=>{}))}newChild(e,t){return i.newChild(t).then((t=>this.treeManager.fetchTierData(e.identifiers)))}}},73:(e,t,n)=>{n.d(t,{Z:()=>p,E:()=>g});var i=n(882),o=n(281),s=n(29),a=n.n(s),r=n(386),l=n(666),d=n(586),c=n(316),h=n(255);function u(e){const t=e.onMetaUpdate,n=e.onRemoveMeta,i=e.onNewMetaKey,o=(0,s.useMemo)((()=>e.metas),[e.metas]),l=(0,r.createColumnHelper)(),h=(()=>{const e=[l.accessor("name",{cell:e=>e.getValue(),header:"Name"}),l.accessor("editor",{cell:e=>{const t=e.getValue()();return a().createElement("span",{ref:e=>{e&&!t.isAttached&&e.appendChild(t.node),null===e&&t.isAttached&&t.dispose()}})},header:"Value"}),l.display({id:"edit",cell:e=>{const i=o[e.row.index];return a().createElement("span",{className:"cas-row-icon-area"},n&&a().createElement(c.ToolbarButtonComponent,{icon:c.closeIcon,onClick:()=>n(i.name),tooltip:`Delete (${i.name})`}),a().createElement(c.ToolbarButtonComponent,{icon:c.checkIcon,onClick:()=>t(i.name,i.editor().model.sharedModel.getSource()),tooltip:"Apply changes"}))}})];return e})(),u=(0,r.useReactTable)({columns:h,data:o,getCoreRowModel:(0,r.getCoreRowModel)()});return a().createElement("div",null,a().createElement("table",{className:"cas-ChildrenTable-table"},a().createElement("thead",null,a().createElement("tr",null,u.getFlatHeaders().map((e=>a().createElement("th",{key:e.id},(0,r.flexRender)(e.column.columnDef.header,e.getContext())))))),a().createElement("tbody",null,u.getRowModel().rows.map((e=>a().createElement("tr",null,e.getVisibleCells().map((e=>a().createElement("td",{key:e.id},(0,r.flexRender)(e.column.columnDef.cell,e.getContext())))))))),a().createElement("tfoot",null,a().createElement("span",null,a().createElement("tr",null,a().createElement("td",{colSpan:3},i&&a().createElement(c.ToolbarButtonComponent,{icon:c.addIcon,onClick:()=>d.InputDialog.getText({title:"New meta attribute",label:"name"}).then((e=>{e.value&&i&&i(e.value)})),tooltip:"Add a new meta attribute"})))))))}class m extends d.ReactWidget{constructor(e,t,n,i){super(),this.attributes=e,this.onMetaUpdate=t,this.onRemoveMeta=n,i.connect((e=>this.onMetaChanged(e.additionalMeta)))}onMetaChanged(e){const t={};for(const n of Object.keys(this.attributes)){const i=e[n];t[n]=i}this.attributes=t,this.update()}onNewMetaKey(e){this.attributes[e]=void 0,this.update()}render(){const e=[];for(const t of Object.keys(this.attributes)){const n=new l.CodeEditorWrapper({model:new l.CodeEditor.Model({mimeType:"application/json"}),factory:h.KG.contentFactory.newInlineEditor,editorOptions:{config:{lineNumbers:!1}}}),i=this.attributes[t];n.model.sharedModel.setSource(i?JSON.stringify(i):""),e.push({name:t,editor:()=>n})}const t=this.onNewMetaKey.bind(this);return a().createElement("div",null,a().createElement(u,{metas:e,onMetaUpdate:this.onMetaUpdate,onNewMetaKey:t,onRemoveMeta:this.onRemoveMeta}))}}class p extends i.Panel{constructor(e,t){super(),this.model=e;const n=this.table=new m({},this.onMetaUpdate.bind(this),this.onRemoveMeta.bind(this),this.model.changed);this.addWidget(n),t&&this.render(t)}ready(){return this.model.ready}onMetaUpdate(e,t){var n,i;const o=null===(n=this.model.metaFile)||void 0===n?void 0:n.model.toJSON();o[e]=JSON.parse(t),null===(i=this.model.metaFile)||void 0===i||i.model.fromJSON(o)}onRemoveMeta(e){var t,n;const i=null===(t=this.model.metaFile)||void 0===t?void 0:t.model.toJSON();delete i[e],null===(n=this.model.metaFile)||void 0===n||n.model.fromJSON(i)}render(e){this.ready().then((()=>{const t={};for(const n of e){const e=this.model.additionalMeta[n];t[n]=e}this.table.attributes=t,this.table.update()}))}}class g extends i.Panel{constructor(e){super(),this._mimeType=e.mimeType;const t=e.resolver;this._path=t.path,this.fetchModel=h.KG.treeManager.lookup(this.name).then((e=>{if(e)return this.tierModel=h.KG.tierModelManager.get(e.name)(e),console.log("B"),console.log(this.tierModel),this.tierModel})),this.fetchModel.then((e=>{e&&(this.editor=new p(e),this.addWidget(this.editor))}))}ready(){return this.fetchModel.then((e=>null==e?void 0:e.ready.then()))}get path(){return this._path}get name(){return o.PathExt.basename(this.path,".ipynb")}renderModel(e){let t=e.data[this._mimeType].values;return"string"==typeof t&&(t=[t]),this.ready().then((()=>{this.editor.render(t)})),Promise.resolve()}}},541:(e,t,n)=>{n.d(t,{d3:()=>w,sy:()=>g});var i=n(882),o=n(281),s=n(316),a=n(255),r=n(770),l=n(29),d=n.n(l),c=n(386),h=n(586);function u(e){const t=e.onChildLaunch,n=e.onChildView,i=(0,l.useMemo)((()=>e.children),[e.children]),o=(0,c.createColumnHelper)(),a=(()=>{const e=[o.display({id:"name",cell:e=>{const[t,n]=i[e.row.index];return d().createElement("span",{className:"cas-tier-name"},n.name)},header:"Name"}),o.display({id:"info",cell:e=>{const[t,n]=i[e.row.index];return d().createElement("span",null,n.info)},header:"Info"}),o.display({id:"actions",cell:e=>{const[o,a]=i[e.row.index];return d().createElement("div",{className:"cas-row-icon-area"},d().createElement(s.ToolbarButtonComponent,{icon:s.launchIcon,onClick:()=>t(a),tooltip:`Open ${a.name}`}),d().createElement(s.ToolbarButtonComponent,{icon:s.treeViewIcon,onClick:()=>n(a,o),tooltip:`Show ${a.name} in browser`}))}})];return e})(),r=(0,c.useReactTable)({columns:a,data:i,getCoreRowModel:(0,c.getCoreRowModel)()});return d().createElement("table",{className:"cas-ChildrenTable-table"},d().createElement("thead",null,d().createElement("tr",null,r.getFlatHeaders().map((e=>d().createElement("th",{key:e.id},(0,c.flexRender)(e.column.columnDef.header,e.getContext())))))),d().createElement("tbody",null,r.getRowModel().rows.map((e=>d().createElement("tr",null,e.getVisibleCells().map((e=>d().createElement("td",{key:e.id},(0,c.flexRender)(e.column.columnDef.cell,e.getContext())))))))),d().createElement("tfoot",null,d().createElement("span",null,d().createElement("tr",null,d().createElement("td",{colSpan:3},d().createElement(s.ToolbarButtonComponent,{icon:s.addIcon,onClick:()=>e.onCreateChild(),tooltip:"Create new child"}))))))}class m extends h.ReactWidget{constructor(e,t,n,i){super(),this.addClass("cas-ChildrenSummaryWidget"),this._data=e,this.onChildLaunch=t,this.onChildView=n,this.onCreateChild=i}get data(){return this._data}set data(e){this._data=e,this.update()}render(){return d().createElement("div",null,d().createElement(u,{children:this.data,onChildLaunch:this.onChildLaunch,onChildView:this.onChildView,onCreateChild:this.onCreateChild}))}}var p=n(71);class g extends i.BoxPanel{constructor(e){var t;super(),this.addClass("cas-TierNotebookHeader");const n=this.toolbar=new s.Toolbar;this.model=a.KG.tierModelManager.get(e.name)(e);const o=this.nameLabel=new i.Widget;o.node.textContent=this.model.name,n.addItem("name",o);const r=new i.Widget;r.node.textContent=(null===(t=this.model.started)||void 0===t?void 0:t.toLocaleDateString())&&"",n.addItem("started",r);const l=new s.ToolbarButton({icon:s.treeViewIcon,onClick:()=>{this.showInBrowser()},tooltip:`Show ${this.model.name} in browser`});n.addItem("show in browser",l),this.addWidget(n),i.BoxPanel.setStretch(n,0),this.model.changed.connect((()=>this.onContentChanged()))}static attachToNotebook(e,t){const n=o.PathExt.basename(t.path,".ipynb");return a.KG.treeManager.lookup(n).then((n=>{if(n){const i=new g(n);return e.contentHeader.addWidget(i),t.saveState.connect(((e,t)=>{"started"===t&&i.model.save()})),i}}))}showInBrowser(){a.KG.launchTierBrowser(this.model.identifiers)}onContentChanged(){this.model.dirty?this.nameLabel.node.textContent=this.model.name+"*":this.nameLabel.node.textContent=this.model.name}}class C extends i.Panel{constructor(e){super(),this.addClass("cas-TierNotebookHeader"),this.model=a.KG.tierModelManager.get(e.name)(e);const t=document.createElement("h1");t.textContent=this.model.name,this.addWidget(new i.Widget({node:t}));const n=this.content=new i.SplitPanel;n.addClass("cas-TierNotebookHeader-content");const o=new i.Panel;o.addClass("cas-TierNotebookHeader-content-child");const s=document.createElement("h3");s.textContent="Description",o.addWidget(new i.Widget({node:s}));const l=this.descriptionEditor=new r.cE(this.model.description,!0,(e=>{this.model.description=e}));o.addWidget(l),n.addWidget(o);const d=new i.Panel;d.addClass("cas-TierNotebookHeader-content-child");const c=document.createElement("h3");c.textContent="Conclusion",d.addWidget(new i.Widget({node:c}));const h=this.conclusionEditor=new r.cE(this.model.conclusion,!0,(e=>{this.model.conclusion=e}));d.addWidget(h),n.addWidget(d),this.addWidget(n);const u=new i.Panel;u.addClass("cas-TierNotebookHeader-content-child");const g=document.createElement("h3");g.textContent="Children",u.addWidget(new i.Widget({node:g})),this.model.children.then((e=>{const t=this.childrenSummary=new m(e?Object.entries(e):[],(e=>e&&a.KG.launchTier(e)),((e,t)=>a.KG.launchTierBrowser([...this.model.identifiers,t])),(()=>this.model.treeData.then((e=>e&&(0,p.D$)(e)))));u.addWidget(t),n.addWidget(u)})),this.model.changed.connect((()=>this.onContentChanged())),this.model.ready.then((()=>this.onContentChanged()))}showInBrowser(){a.KG.launchTierBrowser(this.model.identifiers)}onContentChanged(){this.descriptionEditor.source=this.model.description,this.conclusionEditor.source=this.model.conclusion,this.model.children.then((e=>{this.childrenSummary.data=e?Object.entries(e):[]}))}}class w extends i.Panel{constructor(e){super(),this._mimeType=e.mimeType;const t=e.resolver;this._path=t.path,this.fetchModel=a.KG.treeManager.lookup(this.name).then((e=>{if(e)return this.addWidget(new C(e)),this.tierModel=a.KG.tierModelManager.get(e.name)(e),this.tierModel}))}ready(){return this.fetchModel.then((e=>null==e?void 0:e.ready.then()))}get path(){return this._path}get name(){return o.PathExt.basename(this.path,".ipynb")}renderModel(e){return this._mimeType,Promise.resolve()}}},71:(e,t,n)=>{n.d(t,{D$:()=>p});var i=n(882),o=n(586),s=n(255);class a extends i.Widget{get elem(){return"input"}constructor(e){if(super(),this.addClass("jp-Input-Dialog"),this.input=document.createElement(this.elem),this.input.classList.add("jp-mod-styled"),this.input.id="jp-dialog-input-id",void 0!==e){const t=document.createElement("label");t.textContent=e,t.htmlFor=this.input.id,this.node.appendChild(t)}this.node.appendChild(this.input)}}class r extends a{constructor(e){super(e.label),this.input.type="number",this.input.value=e.value?e.value.toString():"0"}getValue(){return this.input.value?Number(this.input.value):Number.NaN}}class l extends a{constructor(e){super(e.label),this.input.type="text",this.input.value=e.text?e.text:"",e.placeholder&&(this.input.placeholder=e.placeholder),this._initialSelectionRange=Math.min(this.input.value.length,Math.max(0,this.input.value.length))}onAfterAttach(e){super.onAfterAttach(e),this._initialSelectionRange>0&&this.input.value&&this.input.setSelectionRange(0,this._initialSelectionRange)}getValue(){return this.input.value}}class d extends a{constructor(e){super(e.label),this._editable=e.editable||!1;let t,n=e.current||0;if("number"==typeof n&&(t=Math.max(0,Math.min(n,e.items.length-1)),n=""),this.list=document.createElement("select"),e.items.forEach(((e,i)=>{const o=document.createElement("option");i===t&&(o.selected=!0,n=e),o.value=e,o.textContent=e,this.list.appendChild(o)})),e.editable){const t=document.createElement("datalist");t.id="input-dialog-items",t.appendChild(this.list),this.input.type="list",this.input.value=n,this.input.setAttribute("list",t.id),e.placeholder&&(this.input.placeholder=e.placeholder),this.node.appendChild(t)}else this.input.remove(),this.node.appendChild(o.Styling.wrapSelect(this.list))}getValue(){return this._editable?this.input.value:this.list.value}}class c extends a{get elem(){return"textarea"}constructor(e){super(e.label)}getValue(){return this.input.value}}class h extends l{constructor(e){super(e),this.idRegex=new RegExp(`^${e.idRegex}$`),this.nameTemplate=e.nameTemplate,this.input.addEventListener("input",this.validateInput.bind(this)),this.previewBox=document.createElement("span"),this.node.appendChild(this.previewBox),this.previewBox.textContent=`Preview: ${this.nameTemplate.replace("{}","?")}`}validateInput(){const e=this.input.value;return this.previewBox.textContent=`Preview: ${this.nameTemplate.replace("{}",e)}`,e&&!this.idRegex.test(e)?(this.input.classList.add("cas-invalid-id"),!1):(this.input.classList.remove("cas-invalid-id"),!0)}}class u extends i.Widget{constructor(e){super(),this.parentName=e.name;const t=this.layout=new i.PanelLayout,n=(e.identifiers.length?e.name:"")+e.childClsInfo.namePartTemplate,o=this.identifierInput=new h({title:"Identitifier",label:"Identifier",idRegex:e.childClsInfo.idRegex,nameTemplate:n}),s=this.descriptionInput=new c({title:"Da Description",label:"Description"}),a=this.templateSelector=new d({title:"template",label:"Template",items:e.childClsInfo.templates||[]});this.subInputs={id:o,description:s,template:a};const u=this.metaInputs=[];t.addWidget(o),t.addWidget(s),t.addWidget(a);for(const n of e.childClsInfo.metaNames){let e;e="string"==typeof n?new l({title:"",label:n}):new r({title:"",label:n}),u.push(e),this.subInputs[n]=e,t.addWidget(e)}}getValue(){const e={};for(const t in this.subInputs)e[t]=this.subInputs[t].getValue();return e.parent=this.parentName,e}}class m extends o.Dialog{_evtKeydown(e){13===e.keyCode&&document.activeElement instanceof HTMLTextAreaElement||super._evtKeydown(e)}}function p(e){var t;const n=new u(e);return new m({title:`Create New ${null===(t=e.childClsInfo)||void 0===t?void 0:t.name}`,body:n}).launch().then((t=>t.value?s.KG.newChild(e,t.value):Promise.resolve(null)))}},770:(e,t,n)=>{n.d(t,{R7:()=>h,cE:()=>c});var i=n(882),o=n(316),s=n(836),a=n(666),r=n(255),l=n(73);function d(e,t){const n=document.createElement(e);return n.textContent=t,new i.Widget({node:n})}class c extends i.Panel{constructor(e,t,n){super(),this.addClass("cas-MarkdownEditor"),this.onContentChanged=n;const s=document.createElement("div");s.className="cas-icon-area",s.classList.add("jp-ToolbarButtonComponent-icon"),this.node.appendChild(s),this.editButton=new o.ToolbarButton({icon:o.editIcon,onClick:()=>{this.setRendered(!1)},tooltip:"Edit"}),this.checkButton=new o.ToolbarButton({icon:o.checkIcon,onClick:()=>{this.setRendered(!0)},tooltip:"Apply changes"});const l=this.output=new i.Widget({node:document.createElement("div")});l.addClass("cas-markdown-editor-content"),this.addWidget(l),this.editor=new a.CodeEditorWrapper({model:new a.CodeEditor.Model({mimeType:"text/x-markdown"}),factory:r.KG.contentFactory.newInlineEditor,editorOptions:{config:{lineNumbers:!1}}}),this.editor.addClass("cas-markdown-editor-content"),this.source=e,this.addWidget(this.editor),l.node.ondblclick=e=>{this.setRendered(!1)},this.editor.node.addEventListener("focusout",(e=>{this.setRendered(!0)})),this.onAfterAttach=()=>{i.Widget.attach(this.editButton,s),i.Widget.attach(this.checkButton,s)}}get source(){return this.editor.model.sharedModel.source}set source(e){this.editor.model.sharedModel.source=e,this.onStateChanged()}get rendered(){return this._rendered}setRendered(e){this._rendered=e,this.onStateChanged(),!0===e&&this.onContentChanged(this.source)}onStateChanged(){if(this.rendered){const e=r.KG.rendermimeRegistry;(0,s.renderMarkdown)({host:this.output.node,source:this.source,trusted:!1,sanitizer:e.sanitizer,resolver:e.resolver,linkHandler:e.linkHandler,latexTypesetter:e.latexTypesetter,shouldTypeset:!0,markdownParser:e.markdownParser}),this.editor.setHidden(!0),this.checkButton.setHidden(!0),this.output.setHidden(!1),this.editButton.setHidden(!1)}else this.editor.setHidden(!1),this.checkButton.setHidden(!1),this.output.setHidden(!0),this.editButton.setHidden(!0)}}class h extends i.BoxPanel{constructor(e){super(),this.model=r.KG.tierModelManager.get(e.name)(e),console.log(this.model),this.addClass("cas-tier-widget");const t=this.toolbar=new o.Toolbar,n=new o.ToolbarButton({icon:o.saveIcon,onClick:()=>{this.save()},tooltip:"Save changes to disk"}),s=new o.ToolbarButton({icon:o.refreshIcon,onClick:()=>{this.fetch()},tooltip:"Fetch from disk"}),a=new o.ToolbarButton({icon:o.launchIcon,onClick:()=>{r.KG.launchTier(this.model)},tooltip:`Open ${this.model.name}`});t.addItem("save",n),t.addItem("refresh",s),t.addItem("launch",a),this.addWidget(t),i.BoxPanel.setStretch(t,0);const h=new i.Panel;h.addClass("cas-tier-widget-content"),this.addWidget(h),i.BoxPanel.setStretch(h,1),this.tierTitle=d("h1","Name"),h.addWidget(this.tierTitle),h.addWidget(d("h2","Description"));const u=this.descriptionCell=new c(this.model.description,!0,(e=>this.model.description=e));h.addWidget(u),h.addWidget(d("h2","Highlights")),this.highlightsBox=new i.Panel,this.highlightsBox.addClass("cas-tier-highlights-box"),this.hltsRenderPromise=Promise.resolve(!0),this.renderHighlights(),h.addWidget(this.highlightsBox),h.addWidget(d("h2","Conclusion"));const m=this.concCell=new c(this.model.conclusion,!0,(e=>this.model.conclusion=e));h.addWidget(m),h.addWidget(d("h2","Meta"));const p=this.metaView=new l.Z(this.model,Object.keys(this.model.additionalMeta));h.addWidget(p),this.model.ready.then((()=>this.onContentChanged())),this.model.changed.connect((e=>this.onContentChanged()))}onContentChanged(){this.model.metaFile&&(this.model.dirty?this.tierTitle.node.textContent=this.model.name+"*":this.tierTitle.node.textContent=this.model.name,this.descriptionCell.source=this.model.description,this.concCell.source=this.model.conclusion,this.metaView.render(Object.keys(this.model.additionalMeta)),this.renderHighlights())}renderHighlights(){if(!this.highlightsBox)return!0;for(const e of Array.from(this.highlightsBox.widgets))e.dispose();const e=r.KG.rendermimeRegistry.clone({resolver:new s.RenderMimeRegistry.UrlResolver({contents:r.KG.contentService.contents,path:this.model.notebookPath})});for(const t of this.model.hltsOutputs){const n=t.data;for(const t of Object.keys(n)){const i=e.createRenderer(t);this.highlightsBox.addWidget(i),i.renderModel(new s.MimeModel({data:n,trusted:!1}))}}}save(){this.model.save()}fetch(){this.model.revert()}}}}]);